<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MemoLearning ‚Äî Calculus I: Limits & Continuity (Expanded)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* ---------- GLOBAL VARIABLES ---------- */
    :root{
      --indigo:#6366f1;--indigo-light:#818cf8;--indigo-dark:#4f46e5;
      --purple:#7c3aed;--purple-light:#8b5cf6;--purple-dark:#6d28d9;
      --slate:#0f172a;--slate-light:#334155;
      --muted:#475569;--muted-light:#94a3b8;
      --card:#ffffff;--card-alt:#f8fafc;
      --success:#10b981;--success-light:#d1fae5;
      --warning:#f59e0b;--warning-light:#fef3c7;
      --danger:#ef4444;--danger-light:#fee2e2;
      --info:#3b82f6;--info-light:#dbeafe;
      --radius-sm:6px;--radius:12px;--radius-lg:18px;--radius-xl:24px;
      --shadow-sm:0 4px 6px rgba(0,0,0,0.05);--shadow:0 10px 25px rgba(0,0,0,0.1);--shadow-lg:0 20px 40px rgba(0,0,0,0.15);
      --transition:all .3s ease
    }

    /* ---------- GLOBAL STYLES ---------- */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;scroll-behavior:smooth}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--slate);background:linear-gradient(135deg,#667eea 0%,#7c3aed 100%) fixed;line-height:1.6}

    /* ---------- TYPOGRAPHY ---------- */
    h1,h2,h3,h4,h5,h6{font-weight:700;line-height:1.2;margin-bottom:.5em}

    /* ---------- BUTTONS ---------- */
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;background:var(--indigo);color:#fff;border:none;padding:10px 18px;border-radius:var(--radius);cursor:pointer;font-weight:500;transition:var(--transition);box-shadow:var(--shadow-sm)}
    .btn:hover{background:var(--indigo-dark);transform:translateY(-2px);box-shadow:var(--shadow)}
    .btn.secondary{background:var(--slate)}
    .btn.secondary:hover{background:#1e293b}
    .btn.outline{background:transparent;border:2px solid var(--indigo);color:var(--indigo)}
    .btn.outline:hover{background:var(--indigo);color:white}
    .btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
    .btn i{font-size:.9em}

    /* ---------- OVERVIEW PAGE ---------- */
    .overview-page{display:block;min-height:100vh}
    .overview-page.hidden{display:none}
    .overview-header{background:rgba(255,255,255,.10);backdrop-filter:blur(20px);color:#fff;padding:60px 20px;text-align:center;border-bottom:1px solid rgba(255,255,255,.25)}
    .overview-header h1{margin:0;font-weight:800;font-size:48px;text-shadow:0 2px 20px rgba(0,0,0,.35);letter-spacing:-.5px}
    .overview-header p{margin:16px 0 0;font-size:20px;opacity:.95;font-weight:300;max-width:700px;margin-left:auto;margin-right:auto}

    .container{max-width:1400px;margin:0 auto;padding:40px 20px}

    .curriculum-stats{background:rgba(255,255,255,.10);backdrop-filter:blur(18px);border-radius:var(--radius-xl);padding:32px;color:#fff;margin-bottom:32px;box-shadow:var(--shadow)}
    .curriculum-stats h2{margin:0 0 20px 0;font-size:28px;font-weight:700}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:24px}
    .stat-item{text-align:center;padding:16px;background:rgba(255,255,255,.1);border-radius:var(--radius-lg);transition:var(--transition)}
    .stat-item:hover{background:rgba(255,255,255,.15);transform:translateY(-3px)}
    .stat-number{font-size:42px;font-weight:800;display:block;margin-bottom:4px;background:linear-gradient(135deg,#fff,#e0e7ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .stat-label{opacity:.9;font-size:16px}

    .units-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(380px,1fr));gap:28px}
    .unit-card{position:relative;background:rgba(255,255,255,.98);border:1px solid rgba(255,255,255,.4);border-radius:var(--radius-xl);padding:28px;box-shadow:var(--shadow);cursor:pointer;overflow:hidden;transition:var(--transition)}
    .unit-card::before{content:'';position:absolute;top:0;left:0;right:0;height:5px;background:linear-gradient(90deg,var(--indigo),var(--purple))}
    .unit-card:hover{transform:translateY(-8px);box-shadow:var(--shadow-lg)}
    .unit-header{display:flex;align-items:center;margin-bottom:14px}
    .unit-number{width:42px;height:42px;border-radius:999px;background:linear-gradient(135deg,var(--indigo),var(--purple));color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;box-shadow:0 6px 16px rgba(102,126,234,.4);margin-right:16px;flex-shrink:0}
    .unit-title{margin:0;font-weight:700;font-size:22px;color:var(--slate)}
    .unit-description{color:var(--muted);margin:8px 0 16px;font-size:15px}
    .topics-list{list-style:none;margin:0;padding:0}
    .topics-list li{position:relative;padding:10px 0 10px 24px;border-bottom:1px solid #f1f5f9;color:var(--slate-light);transition:var(--transition)}
    .topics-list li:hover{background:#f8fafc;padding-left:28px}
    .topics-list li:last-child{border-bottom:none}
    .topics-list li::before{content:'‚ñ∏';position:absolute;left:8px;color:var(--indigo);font-weight:700}

    @keyframes fadeInUp{from{opacity:0;transform:translateY(22px)}to{opacity:1;transform:translateY(0)}}
    .unit-card{opacity:0;animation:fadeInUp .6s ease forwards}

    /* ---------- UNIT PAGE ---------- */
    .unit-page{display:none;min-height:100vh}
    .unit-page.active{display:block}
    .unit-header-stick{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.95);backdrop-filter:saturate(1.15) blur(8px);border-bottom:1px solid rgba(0,0,0,.1);color:var(--slate);padding:16px 20px;box-shadow:var(--shadow-sm)}
    .unit-header-stick .wrap{max-width:1200px;margin:0 auto;display:flex;gap:16px;align-items:center}
    .unit-header-stick h1{margin:0;font-size:24px;font-weight:700;color:var(--slate)}
    .unit-header-stick .sub{color:var(--muted);font-size:15px}

    .app{max-width:1200px;margin:24px auto;display:grid;grid-template-columns:320px 1fr;gap:24px;padding:0 20px}
    aside{background:#fff;border:1px solid #e5e7eb;border-radius:var(--radius-xl);box-shadow:var(--shadow);overflow:hidden;align-self:start;position:sticky;top:90px;max-height:calc(100vh - 120px);display:flex;flex-direction:column}
    .side-head{padding:20px;border-bottom:1px solid #e5e7eb;background:linear-gradient(135deg,rgba(99,102,241,.12),rgba(124,58,237,.12))}
    .side-head h2{margin:0 0 8px 0;font-size:18px;color:var(--slate)}
    .progress{height:10px;border-radius:999px;background:#eef2ff;overflow:hidden;margin-top:10px}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,var(--indigo),var(--purple));width:0%;border-radius:999px;transition:width .5s ease}
    .progress-text{font-size:12px;color:var(--muted);margin-top:6px;text-align:right}

    .lesson-list{list-style:none;margin:0;padding:0;overflow:auto;flex-grow:1}
    .lesson-list li{border-bottom:1px solid #eef2ff}
    .lesson{display:flex;gap:12px;padding:14px 16px;text-decoration:none;color:inherit;cursor:pointer;align-items:center;transition:var(--transition)}
    .lesson:hover{background:#f8fafc}
    .lesson.active{background:#eef2ff;border-left:4px solid var(--indigo)}
    .tag{font-size:11px;color:var(--indigo);font-weight:700;background:#eef2ff;border-radius:999px;padding:4px 8px;text-transform:uppercase;letter-spacing:.5px}
    .done{margin-left:auto;font-size:12px;color:var(--success);font-weight:700;display:none}
    .lesson.completed .done{display:inline-flex;align-items:center;gap:4px}

    main{min-height:70vh}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:var(--radius-xl);box-shadow:var(--shadow);padding:28px;margin-bottom:24px}
    .crumbs{color:var(--muted);font-size:13px;margin-bottom:8px;display:flex;align-items:center;gap:6px}
    .crumbs span:not(:last-child)::after{content:'/';margin:0 8px;color:var(--muted-light)}
    .title{margin:4px 0 8px;font-size:28px;font-weight:800;color:var(--slate);line-height:1.2}
    .lead{color:var(--muted);margin:0 0 16px;font-size:17px;line-height:1.5}

    .content-block{margin-bottom:20px}
    .content-block p{margin-bottom:16px;line-height:1.7}

    .example{border:1px solid #c7d2fe;background:#eef2ff;padding:18px 20px;border-radius:var(--radius);margin:16px 0;position:relative}
    .example h4{margin:0 0 8px;color:var(--indigo-dark);display:flex;align-items:center;gap:8px}
    .example h4 i{font-size:18px;flex-shrink:0}

    .note{border-left:4px solid var(--success);background:var(--success-light);padding:16px 20px;border-radius:var(--radius);margin:16px 0;display:flex;gap:12px}
    .note::before{content:'üí°';font-size:18px;flex-shrink:0}

    .warn{border-left:4px solid var(--warning);background:var(--warning-light);padding:16px 20px;border-radius:var(--radius);margin:16px 0;display:flex;gap:12px}
    .warn::before{content:'‚ö†Ô∏è';font-size:18px;flex-shrink:0}

    .practice,.quiz{margin-top:24px;padding-top:24px;border-top:1px dashed #e5e7eb}
    .problem,.q{border:1px solid #e5e7eb;border-radius:var(--radius-lg);background:var(--card-alt);padding:20px;margin:16px 0}
    .problem h5,.q h5{margin:0 0 12px;font-size:18px;color:var(--slate)}
    .choice{display:flex;gap:12px;align-items:center;border:1px solid #e5e7eb;border-radius:var(--radius);padding:12px;margin:8px 0;cursor:pointer;transition:var(--transition)}
    .choice:hover{background:#f1f5f9;border-color:var(--indigo-light)}
    .choice input[type="radio"]{accent-color:var(--indigo)}
    .input{padding:12px 14px;border:1px solid #cbd5e1;border-radius:var(--radius);width:100%;max-width:320px;font-family:inherit;font-size:15px;transition:var(--transition)}
    .input:focus{outline:none;border-color:var(--indigo);box-shadow:0 0 0 3px rgba(99,102,241,.2)}
    .ok{color:#065f46;background:var(--success-light);border:1px solid var(--success);padding:12px 16px;border-radius:var(--radius);margin-top:12px;display:flex;align-items:center;gap:8px}
    .bad{color:#991b1b;background:var(--danger-light);border:1px solid var(--danger);padding:12px 16px;border-radius:var(--radius);margin-top:12px;display:flex;align-items:center;gap:8px}
    .help{color:var(--info);text-decoration:underline;cursor:pointer;display:inline-flex;align-items:center;gap:6px;margin-top:12px;font-weight:500}
    .solution{display:none;padding:16px;border:1px dashed #93c5fd;background:var(--info-light);color:#1e3a8a;border-radius:var(--radius);margin-top:12px;white-space:pre-line;line-height:1.6}

    .footer-nav{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:24px;padding-top:20px;border-top:1px solid #e5e7eb}

    /* Math styling */
    .equation{background:#f8fafc;padding:12px 16px;border-radius:var(--radius);margin:12px 0;overflow-x:auto}
    .math-inline{font-family:'Times New Roman',serif;font-style:italic}

    /* Quiz results */
    .quiz-results{margin-top:20px;padding:20px;background:#f8fafc;border-radius:var(--radius);text-align:center}
    .score-display{font-size:24px;font-weight:700;margin-bottom:16px;color:var(--indigo-dark)}
    .correct-answer{color:var(--success)}
    .incorrect-answer{color:var(--danger)}

    /* Responsive */
    @media (max-width:1024px){.app{grid-template-columns:1fr;gap:20px}aside{position:static;max-height:none}.unit-header-stick .wrap{flex-wrap:wrap}.units-grid{grid-template-columns:1fr}}
    @media (max-width:768px){.overview-header{padding:40px 20px}.overview-header h1{font-size:36px}.stats-grid{grid-template-columns:repeat(2,1fr)}.footer-nav{flex-direction:column;align-items:stretch}.footer-nav .btn{width:100%}}
    @media (max-width:480px){.stats-grid{grid-template-columns:1fr}.unit-card{padding:20px}.card{padding:20px}}

    /* Anim */
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
    .correct-pulse{animation:pulse .5s ease}

    /* Code block styling */
    .code-block{background:#1e293b;color:#e2e8f0;padding:16px;border-radius:var(--radius);margin:16px 0;overflow-x:auto;font-family:'Fira Code',monospace;font-size:14px}

    /* Utility */
    .flex{display:flex;gap:8px;align-items:center}
    .mb-0{margin-bottom:0}
    .mt-8{margin-top:8px}
    .mt-16{margin-top:16px}
    .center{text-align:center}
    .right{text-align:right}
  </style>
</head>
<body>
  <!-- ================= OVERVIEW ================= -->
  <div class="overview-page" id="overviewPage">
    <header class="overview-header">
      <h1><i class="fas fa-graduation-cap"></i> MemoLearning Calculus I</h1>
      <p>Master Calculus I with interactive lessons, step-by-step examples, auto-graded quizzes, and practice generators.</p>
    </header>

    <div class="container">
      <div class="curriculum-stats">
        <h2>Curriculum Overview</h2>
        <div class="stats-grid">
          <div class="stat-item"><span class="stat-number">8</span><div class="stat-label">Total Units</div></div>
          <div class="stat-item"><span class="stat-number">~140</span><div class="stat-label">Skills to Master</div></div>
          <div class="stat-item"><span class="stat-number">6</span><div class="stat-label">Core Units</div></div>
          <div class="stat-item"><span class="stat-number">2</span><div class="stat-label">Application Units</div></div>
        </div>
      </div>

      <div class="units-grid">
        <!-- Unit 1: Limits and Continuity -->
        <div class="unit-card" style="animation-delay:0s" onclick="openUnit(1)">
          <div class="unit-header"><div class="unit-number">1</div><h3 class="unit-title">Limits & Continuity</h3></div>
          <p class="unit-description">Foundation of calculus: limits, continuity, and function behavior.</p>
          <ul class="topics-list">
            <li>Limit intuition & notation</li>
            <li>Algebraic strategies (factor, rationalize, conjugates)</li>
            <li>One-sided & infinite limits</li>
            <li>Continuity: removable, jump, infinite</li>
            <li>Intermediate Value Theorem</li>
            <li>Limits at infinity & asymptotes</li>
            <li>Squeeze Theorem</li>
            <li>Œµ-Œ¥ definition (optional)</li>
          </ul>
        </div>
        <!-- Unit 2: Derivatives -->
        <div class="unit-card" style="animation-delay:.05s" onclick="openUnit(2)">
          <div class="unit-header"><div class="unit-number">2</div><h3 class="unit-title">Derivatives</h3></div>
          <p class="unit-description">Rates of change, tangent lines, and derivative as a limit.</p>
          <ul class="topics-list">
            <li>Definition via difference quotient</li>
            <li>Geometric meaning</li>
            <li>Differentiability vs. continuity</li>
            <li>Basic rules & polynomials</li>
            <li>Higher-order derivatives</li>
          </ul>
        </div>
        <!-- Unit 3: Differentiation Rules -->
        <div class="unit-card" style="animation-delay:.1s" onclick="openUnit(3)">
          <div class="unit-header"><div class="unit-number">3</div><h3 class="unit-title">Differentiation Rules</h3></div>
          <p class="unit-description">Product, quotient, chain rule; trig, exp, log, implicit; related rates.</p>
        </div>
        <!-- Unit 4: Applications of Derivatives -->
        <div class="unit-card" style="animation-delay:.15s" onclick="openUnit(4)">
          <div class="unit-header"><div class="unit-number">4</div><h3 class="unit-title">Applications of Derivatives</h3></div>
          <p class="unit-description">First/second derivative tests, curve sketching, optimization, MVT, L'H√¥pital.</p>
        </div>
        <!-- Unit 5: Integrals -->
        <div class="unit-card" style="animation-delay:.2s" onclick="openUnit(5)">
          <div class="unit-header"><div class="unit-number">5</div><h3 class="unit-title">Integrals</h3></div>
          <p class="unit-description">Antiderivatives, Riemann sums, definite integrals, FTC, average value.</p>
        </div>
        <!-- Unit 6: Integration Techniques -->
        <div class="unit-card" style="animation-delay:.25s" onclick="openUnit(6)">
          <div class="unit-header"><div class="unit-number">6</div><h3 class="unit-title">Integration Techniques</h3></div>
          <p class="unit-description">u-substitution, parts, trig integrals/substitution, partial fractions, improper.</p>
        </div>
        <!-- Unit 7: Applications of Integration -->
        <div class="unit-card" style="animation-delay:.3s" onclick="openUnit(7)">
          <div class="unit-header"><div class="unit-number">7</div><h3 class="unit-title">Applications of Integration</h3></div>
          <p class="unit-description">Area, volumes (disk/washer/shells), arc length, work, centers of mass, DE intro.</p>
        </div>
        <!-- Unit 8: Differential Equations -->
        <div class="unit-card" style="animation-delay:.35s" onclick="openUnit(8)">
          <div class="unit-header"><div class="unit-number">8</div><h3 class="unit-title">Differential Equations</h3></div>
          <p class="unit-description">Slope fields, Euler‚Äôs method, separable DEs, exponential growth/decay, logistic.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= UNIT 1 PAGE ================= -->
  <div class="unit-page" id="unitPage">
    <div class="unit-header-stick">
      <div class="wrap">
        <button class="btn outline" onclick="backToOverview()"><i class="fa-solid fa-arrow-left"></i> Overview</button>
        <div>
          <h1>Unit 1: Limits & Continuity</h1>
          <div class="sub">8 lessons ‚Ä¢ practice sets ‚Ä¢ graded quiz ‚Ä¢ progress saves locally</div>
        </div>
        <div style="margin-left:auto" class="flex">
          <button class="btn secondary" onclick="resetProgress()"><i class="fa-solid fa-rotate"></i> Reset</button>
          <button class="btn" onclick="window.print()"><i class="fa-solid fa-print"></i> Print</button>
        </div>
      </div>
    </div>

    <div class="app">
      <aside>
        <div class="side-head">
          <h2>Unit 1 Lessons</h2>
          <div class="progress"><span id="progressBar"></span></div>
          <div class="progress-text"><span id="progressText">0%</span> complete</div>
        </div>
        <ul class="lesson-list" id="lessonList">
          <li><a class="lesson active" data-target="l1"><span class="tag">Lesson</span> 1. What is a Limit? <span class="done"><i class="fa fa-check"></i> Done</span></a></li>
          <li><a class="lesson" data-target="l2"><span class="tag">Lesson</span> 2. Algebraic Techniques <span class="done"><i class="fa fa-check"></i> Done</span></a></li>
          <li><a class="lesson" data-target="l3"><span class="tag">Lesson</span> 3. One-Sided & Infinite Limits <span class="done"><i class="fa fa-check"></i> Done</span></a></li>
          <li><a class="lesson" data-target="l4"><span class="tag">Lesson</span> 4. Continuity & Types of Discontinuity <span class="done"><i class="fa fa-check"></i> Done</span></a></li>
          <li><a class="lesson" data-target="l5"><span class="tag">Lesson</span> 5. Intermediate Value Theorem <span class="done"><i class="fa fa-check"></i> Done</span></a></li>
          <li><a class="lesson" data-target="l6"><span class="tag">Lesson</span> 6. Squeeze Theorem <span class="done"><i class="fa fa-check"></i> Done</span></a></li>
          <li><a class="lesson" data-target="l7"><span class="tag">Lesson</span> 7. Limits at Infinity & Asymptotes <span class="done"><i class="fa fa-check"></i> Done</span></a></li>
          <li><a class="lesson" data-target="l8"><span class="tag">Lesson</span> 8. Œµ‚ÄìŒ¥ Definition (Optional) <span class="done"><i class="fa fa-check"></i> Done</span></a></li>
          <li><a class="lesson" data-target="quiz"><span class="tag">Quiz</span> Unit 1 Mastery Quiz <span class="done"><i class="fa fa-check"></i> Done</span></a></li>
        </ul>
      </aside>

      <main id="lessonContainer">
        <!-- L1 -->
        <section id="l1" class="card lesson-content">
          <div class="crumbs"><span>Unit 1</span><span>Lesson 1</span></div>
          <h2 class="title">Understanding Limits: Intuition & Notation</h2>
          <p class="lead">A limit describes what value a function <em>approaches</em> as the input gets close to a point. It does not require the function to actually equal that value at the point.</p>

          <div class="definition">
            <h4><i class="fa-regular fa-lightbulb"></i> Formal Idea</h4>
            <p>We write \(\lim_{x\to a} f(x) = L\) if we can make \(f(x)\) arbitrarily close to \(L\) by taking \(x\) sufficiently close to \(a\) (but not necessarily equal to \(a\)).</p>
          </div>

          <div class="content-block">
            <h3>Holes vs. Values</h3>
            <p>Functions can have a ‚Äúhole‚Äù (undefined value) at \(x=a\) yet still have a limit at \(a\). The limit depends on nearby behavior, not the point itself.</p>
            <div class="example">
              <h4><i class="fa-solid fa-pencil"></i> Example 1</h4>
              <p>Evaluate \(\displaystyle \lim_{x\to 2} \frac{x^2-4}{x-2}\).</p>
              <button class="help" onclick="toggleSolution(this)">Show Steps</button>
              <div class="solution">Factor the numerator: \(x^2-4=(x-2)(x+2)\). For \(x\neq 2\), the function equals \(x+2\). Therefore the limit is \(\lim_{x\to 2} (x+2)=4\). (There is a hole at \(x=2\).)</div>
            </div>

            <div class="example">
              <h4><i class="fa-solid fa-pencil"></i> Example 2</h4>
              <p>For \(f(x)=\begin{cases}x^2,&x\neq 1\\ 7,&x=1\end{cases}\), find \(\lim_{x\to 1} f(x)\) and \(f(1)\).</p>
              <button class="help" onclick="toggleSolution(this)">Show Steps</button>
              <div class="solution">As \(x\to 1\), \(x^2\to 1\). Thus \(\lim_{x\to 1} f(x)=1\). But \(f(1)=7\). The limit and the function value need not match.</div>
            </div>
          </div>

          <div class="real-world">
            <h4><i class="fa-solid fa-gauge"></i> Instantaneous Velocity</h4>
            <p>Velocity at an instant is defined as a limit of average velocities over shrinking time intervals. Limits make ‚Äúinstantaneous change‚Äù precise.</p>
          </div>

          <div class="practice">
            <h3>Practice A</h3>
            <div class="problem">
              <h5>1) \(\displaystyle \lim_{x\to 3} \frac{x^2-9}{x-3}\)</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">\(x^2-9=(x-3)(x+3)\). Cancel \((x-3)\). Limit = \(x+3\) at \(x=3\) ‚Üí <strong>6</strong>.</div>
            </div>
            <div class="problem">
              <h5>2) \(\displaystyle \lim_{x\to 0} \frac{|x|}{x}\)</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">Approaching 0 from the right gives 1; from the left gives ‚àí1. Two one‚Äësided limits differ ‚Üí the limit <strong>does not exist</strong>.</div>
            </div>
          </div>
        </section>

        <!-- L2 -->
        <section id="l2" class="card lesson-content" hidden>
          <div class="crumbs"><span>Unit 1</span><span>Lesson 2</span></div>
          <h2 class="title">Algebraic Techniques for Limits</h2>
          <p class="lead">Use algebra to remove indeterminate forms like 0/0: factor, rationalize, simplify complex fractions.</p>

          <div class="content-block">
            <h3>1) Factoring</h3>
            <div class="example">
              <h4><i class="fa-solid fa-pencil"></i> Example</h4>
              <p>\(\displaystyle \lim_{x\to a} \frac{x^2-a^2}{x-a}\)</p>
              <button class="help" onclick="toggleSolution(this)">Show Steps</button>
              <div class="solution">\(x^2-a^2=(x-a)(x+a)\). Cancel \((x-a)\). Limit = \(a+a=2a\).</div>
            </div>
          </div>

          <div class="content-block">
            <h3>2) Rationalizing</h3>
            <div class="example">
              <h4><i class="fa-solid fa-pencil"></i> Example</h4>
              <p>\(\displaystyle \lim_{x\to 0} \frac{\sqrt{x+9}-3}{x}\)</p>
              <button class="help" onclick="toggleSolution(this)">Show Steps</button>
              <div class="solution">Multiply by the conjugate: \(\frac{\sqrt{x+9}-3}{x}\cdot\frac{\sqrt{x+9}+3}{\sqrt{x+9}+3}=\frac{x}{x(\sqrt{x+9}+3)}=\frac{1}{\sqrt{x+9}+3}\to \frac{1}{6}.\)</div>
            </div>
          </div>

          <div class="content-block">
            <h3>3) Complex Fractions</h3>
            <div class="example">
              <h4><i class="fa-solid fa-pencil"></i> Example</h4>
              <p>\(\displaystyle \lim_{x\to 0} \frac{\tfrac{1}{x+1}-1}{x}\)</p>
              <button class="help" onclick="toggleSolution(this)">Show Steps</button>
              <div class="solution">Combine the numerator: \(\frac{1-(x+1)}{x+1}=\frac{-x}{x+1}\). Then the whole expression is \(\frac{-x}{x(x+1)}=\frac{-1}{x+1}\to -1.\)</div>
            </div>
          </div>

          <div class="practice">
            <h3>Practice B</h3>
            <div class="problem">
              <h5>1) \(\displaystyle \lim_{x\to 4} \frac{\sqrt{x}-2}{x-4}\)</h5>
              <button class="help" onclick="toggleSolution(this)">Show Hint</button>
              <div class="solution">Multiply top/bottom by \(\sqrt{x}+2\) ‚Üí becomes \(\frac{1}{\sqrt{x}+2}\) at 4 ‚Üí <strong>1/4</strong>.</div>
            </div>
            <div class="problem">
              <h5>2) \(\displaystyle \lim_{x\to 1} \frac{x^3-1}{x-1}\)</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">Use \(a^3-b^3=(a-b)(a^2+ab+b^2)\). Limit = \(1^2+1\cdot1+1^2=3\).</div>
            </div>
          </div>
        </section>

        <!-- L3 -->
        <section id="l3" class="card lesson-content" hidden>
          <div class="crumbs"><span>Unit 1</span><span>Lesson 3</span></div>
          <h2 class="title">One-Sided & Infinite Limits</h2>
          <p class="lead">When approaching from the left (‚àí) or right (+), limits can differ. Infinite limits describe vertical asymptotes.</p>

          <div class="content-block">
            <h3>One-Sided Limits</h3>
            <div class="example">
              <h4><i class="fa-solid fa-pencil"></i> Example (piecewise)</h4>
              <p>\(f(x)=\begin{cases}x+1,&x<0\\ x^2,&x\ge 0\end{cases}\). Find \(\lim_{x\to 0^-} f(x)\), \(\lim_{x\to 0^+} f(x)\), and \(\lim_{x\to 0} f(x)\).</p>
              <button class="help" onclick="toggleSolution(this)">Show Steps</button>
              <div class="solution">From the left: value ‚Üí 1. From the right: value ‚Üí 0. Two one‚Äësided limits differ ‚Üí overall limit does not exist.</div>
            </div>
          </div>

          <div class="content-block">
            <h3>Infinite Limits & Vertical Asymptotes</h3>
            <div class="example">
              <h4><i class="fa-solid fa-pencil"></i> Example</h4>
              <p>\(\displaystyle \lim_{x\to 2} \frac{1}{(x-2)^2}\)</p>
              <button class="help" onclick="toggleSolution(this)">Show Explanation</button>
              <div class="solution">As \(x\to 2\), denominator ‚Üí 0 but squared (always positive) ‚Üí expression grows without bound: limit is <strong>\(+\infty\)</strong>. There is a vertical asymptote at \(x=2\).</div>
            </div>
          </div>

          <div class="practice">
            <h3>Practice C</h3>
            <div class="problem">
              <h5>1) \(\displaystyle \lim_{x\to 1^-} \frac{|x-1|}{x-1}\)</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">Left of 1, \(|x-1|=-(x-1)\). Ratio = ‚àí1. So the left‚Äëhand limit is ‚àí1.</div>
            </div>
            <div class="problem">
              <h5>2) \(\displaystyle \lim_{x\to 0^+} \ln x\)</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">\(\ln x\to -\infty\) as \(x\to 0^+\).</div>
            </div>
          </div>
        </section>

        <!-- L4 -->
        <section id="l4" class="card lesson-content" hidden>
          <div class="crumbs"><span>Unit 1</span><span>Lesson 4</span></div>
          <h2 class="title">Continuity & Types of Discontinuity</h2>
          <p class="lead">A function is continuous at \(a\) if (1) \(f(a)\) is defined, (2) \(\lim_{x\to a} f(x)\) exists, and (3) they are equal.</p>

          <div class="content-block">
            <div class="definition">
              <h4><i class="fa-regular fa-circle-check"></i> Continuity at a Point</h4>
              <p>\(f\) is continuous at \(a\) iff \(\lim_{x\to a} f(x) = f(a)\).</p>
            </div>
            <div class="note">Common discontinuities: <strong>removable</strong> (hole), <strong>jump</strong> (one‚Äësided limits differ), <strong>infinite</strong> (vertical asymptote).</div>
          </div>

          <div class="example">
            <h4><i class="fa-solid fa-pencil"></i> Make it Continuous</h4>
            <p>Find \(k\) so that \(f(x)=\begin{cases}\frac{x^2-1}{x-1},&x\ne 1\\ k,&x=1\end{cases}\) is continuous at \(x=1\).</p>
            <button class="help" onclick="toggleSolution(this)">Show Steps</button>
            <div class="solution">For \(x\ne 1\), \(f(x)=x+1\). \(\lim_{x\to 1} f(x)=2\). Continuity requires \(k=f(1)=2\).</div>
          </div>

          <div class="practice">
            <h3>Practice D</h3>
            <div class="problem">
              <h5>1) Classify the discontinuity of \(g(x)=\tan x\) at \(x=\tfrac{\pi}{2}\).</h5>
              <button class="help" onclick="toggleSolution(this)">Answer</button>
              <div class="solution">Vertical asymptote ‚Üí <strong>infinite</strong> discontinuity.</div>
            </div>
            <div class="problem">
              <h5>2) Find \(c\) so that \(h(x)=\begin{cases}2x+c,&x<1\\ x^2,&x\ge 1\end{cases}\) is continuous at 1.</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">Left limit at 1 is \(2(1)+c=2+c\). Right value at 1 is \(1\). Set equal: \(2+c=1\Rightarrow c=-1\).</div>
            </div>
          </div>
        </section>

        <!-- L5 -->
        <section id="l5" class="card lesson-content" hidden>
          <div class="crumbs"><span>Unit 1</span><span>Lesson 5</span></div>
          <h2 class="title">Intermediate Value Theorem (IVT)</h2>
          <p class="lead">If \(f\) is continuous on \([a,b]\) and \(N\) is between \(f(a)\) and \(f(b)\), then there exists \(c\in(a,b)\) with \(f(c)=N\).</p>

          <div class="example">
            <h4><i class="fa-solid fa-pencil"></i> Example</h4>
            <p>Show that \(x^3-5x+1=0\) has a root in \([0,2]\).</p>
            <button class="help" onclick="toggleSolution(this)">Show Steps</button>
            <div class="solution">Let \(f(x)=x^3-5x+1\). \(f(0)=1>0\), \(f(2)=8-10+1=-1<0\). \(f\) is continuous ‚áí by IVT there is \(c\in(0,2)\) with \(f(c)=0\).</div>
          </div>

          <div class="practice">
            <h3>Practice E</h3>
            <div class="problem">
              <h5>1) Use IVT to prove a solution exists to \(\cos x = x\) on \([0,1]\).</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">Define \(f(x)=\cos x - x\). Continuous on \([0,1]\). \(f(0)=1>0\), \(f(1)=\cos1-1<0\). By IVT there exists \(c\in(0,1)\) with \(f(c)=0\).</div>
            </div>
          </div>
        </section>

        <!-- L6 -->
        <section id="l6" class="card lesson-content" hidden>
          <div class="crumbs"><span>Unit 1</span><span>Lesson 6</span></div>
          <h2 class="title">Squeeze Theorem</h2>
          <p class="lead">If \(g(x)\le f(x)\le h(x)\) near \(a\) and \(\lim_{x\to a} g(x)=\lim_{x\to a} h(x)=L\), then \(\lim_{x\to a} f(x)=L\).</p>

          <div class="example">
            <h4><i class="fa-solid fa-pencil"></i> Classic Result</h4>
            <p>Prove \(\displaystyle \lim_{x\to 0} \frac{\sin x}{x}=1\).</p>
            <button class="help" onclick="toggleSolution(this)">Sketch</button>
            <div class="solution">Using geometry or series, \(\cos x\le \frac{\sin x}{x}\le 1\) for small \(|x|\). Left/right squeeze to 1.</div>
          </div>

          <div class="practice">
            <h3>Practice F</h3>
            <div class="problem">
              <h5>1) Show \(\displaystyle \lim_{x\to 0} x\sin\!\left(\tfrac{1}{x}\right)=0\).</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">Since \(-1\le \sin(1/x)\le 1\), we have \(-|x|\le x\sin(1/x)\le |x|\). Both bounds ‚Üí 0, so the limit is 0.</div>
            </div>
          </div>
        </section>

        <!-- L7 -->
        <section id="l7" class="card lesson-content" hidden>
          <div class="crumbs"><span>Unit 1</span><span>Lesson 7</span></div>
          <h2 class="title">Limits at Infinity & Horizontal Asymptotes</h2>
          <p class="lead">Compare growth rates. For rational functions, divide by the highest power to analyze end behavior.</p>

          <div class="example">
            <h4><i class="fa-solid fa-pencil"></i> Example</h4>
            <p>\(\displaystyle \lim_{x\to\infty} \frac{5x^2+3}{2x^2-x}\)</p>
            <button class="help" onclick="toggleSolution(this)">Show Steps</button>
            <div class="solution">Divide numerator/denominator by \(x^2\) ‚Üí \(\frac{5+3/x^2}{2-1/x}\to\frac{5}{2}\). Horizontal asymptote: \(y=\tfrac{5}{2}\).</div>
          </div>

          <div class="practice">
            <h3>Practice G</h3>
            <div class="problem">
              <h5>1) \(\displaystyle \lim_{x\to -\infty} \frac{3x^3-2x}{-6x^3+9}\)</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">Leading terms dominate: \(\frac{3x^3}{-6x^3}\to -\tfrac{1}{2}.\)</div>
            </div>
            <div class="problem">
              <h5>2) \(\displaystyle \lim_{x\to\infty} (\sqrt{x^2+4x}-x)\)</h5>
              <button class="help" onclick="toggleSolution(this)">Show Steps</button>
              <div class="solution">Rationalize: multiply by \(\sqrt{x^2+4x}+x\) to get \(\frac{4x}{\sqrt{x^2+4x}+x}\to 2\).</div>
            </div>
          </div>
        </section>

        <!-- L8 -->
        <section id="l8" class="card lesson-content" hidden>
          <div class="crumbs"><span>Unit 1</span><span>Lesson 8</span></div>
          <h2 class="title">Œµ‚ÄìŒ¥ Definition (Optional)</h2>
          <p class="lead">Formal definition: \(\lim_{x\to a} f(x)=L\) if for every \(\varepsilon>0\) there exists \(\delta>0\) such that \(0<|x-a|<\delta\Rightarrow |f(x)-L|<\varepsilon\).</p>

          <div class="example">
            <h4><i class="fa-solid fa-pencil"></i> Linear Function</h4>
            <p>Prove using Œµ‚ÄìŒ¥ that \(\lim_{x\to a} (mx+b) = ma+b\).</p>
            <button class="help" onclick="toggleSolution(this)">Show Proof</button>
            <div class="solution">We want \(|(mx+b)-(ma+b)|=|m||x-a|<\varepsilon\). Choose \(\delta=\varepsilon/|m|\) (for \(m\ne 0\)). Then if \(|x-a|<\delta\), the inequality holds.</div>
          </div>

          <div class="practice">
            <h3>Practice H</h3>
            <div class="problem">
              <h5>1) Give a Œ¥ in terms of Œµ to prove \(\lim_{x\to 2} 3x = 6\).</h5>
              <button class="help" onclick="toggleSolution(this)">Show Solution</button>
              <div class="solution">\(|3x-6|=3|x-2|<\varepsilon\) ‚áí choose \(\delta=\varepsilon/3\).</div>
            </div>
          </div>
        </section>

        <!-- QUIZ -->
        <section id="quiz" class="card quiz" hidden>
          <div class="crumbs"><span>Unit 1</span><span>Mastery Quiz</span></div>
          <h2 class="title">Unit 1 Mastery Quiz</h2>
          <p class="lead">12 questions ‚Ä¢ mix of multiple choice and short response. Answers are auto-checked with explanations.</p>

          <!-- Q1 MC -->
          <div class="q" data-type="mc" data-points="1">
            <h5>1) Which best describes \(\lim_{x\to a} f(x)=L\)?</h5>
            <label class="choice"><input type="radio" name="q1"> The function equals L at x=a</label>
            <label class="choice" data-correct="true"><input type="radio" name="q1"> f(x) approaches L as x approaches a</label>
            <label class="choice"><input type="radio" name="q1"> The slope at a is L</label>
          </div>

          <!-- Q2 numeric -->
          <div class="q" data-type="num" data-answer="4" data-tol="0.0001" data-points="1">
            <h5>2) Evaluate: \(\displaystyle \lim_{x\to 2} \frac{x^2-4}{x-2}\).</h5>
            <input class="input" placeholder="Enter a number" />
            <div class="solution mt-8">Factor to \(x+2\). Answer: <strong>4</strong>.</div>
          </div>

          <!-- Q3 short -->
          <div class="q" data-type="short" data-answer="does not exist,dne,no limit" data-points="1">
            <h5>3) The limit of \(\frac{|x|}{x}\) as \(x\to 0\) ______.</h5>
            <input class="input" placeholder="Type words (e.g., DNE)" />
            <div class="solution mt-8">Right-hand limit = 1, left-hand = ‚àí1 ‚áí <strong>DNE</strong>.</div>
          </div>

          <!-- Q4 MC -->
          <div class="q" data-type="mc" data-points="1">
            <h5>4) If a function is continuous at a, which must be true?</h5>
            <label class="choice" data-correct="true"><input type="radio" name="q4"> \(\lim_{x\to a} f(x)=f(a)\)</label>
            <label class="choice"><input type="radio" name="q4"> f is differentiable at a</label>
            <label class="choice"><input type="radio" name="q4"> f has a vertical asymptote at a</label>
          </div>

          <!-- Q5 numeric -->
          <div class="q" data-type="num" data-answer="0.1666667,1/6" data-tol="0.001" data-points="1">
            <h5>5) \(\displaystyle \lim_{x\to 0} \frac{\sqrt{x+9}-3}{x}\) = ?</h5>
            <input class="input" placeholder="e.g., 1/6 or 0.1667" />
            <div class="solution mt-8">Conjugate ‚Üí \(\frac{1}{\sqrt{x+9}+3}\to\frac{1}{6}\).</div>
          </div>

          <!-- Q6 short -->
          <div class="q" data-type="short" data-answer="jump" data-accept="jump discontinuity" data-points="1">
            <h5>6) If \(\lim_{x\to a^-} f(x)\neq \lim_{x\to a^+} f(x)\), name the discontinuity.</h5>
            <input class="input" placeholder="Type the type" />
            <div class="solution mt-8">Different one-sided limits ‚áí <strong>jump</strong> discontinuity.</div>
          </div>

          <!-- Q7 MC -->
          <div class="q" data-type="mc" data-points="1">
            <h5>7) IVT guarantees a root of f on [a,b] when‚Ä¶</h5>
            <label class="choice" data-correct="true"><input type="radio" name="q7"> f is continuous on [a,b] and f(a)¬∑f(b) &lt; 0</label>
            <label class="choice"><input type="radio" name="q7"> f is differentiable on (a,b)</label>
            <label class="choice"><input type="radio" name="q7"> f is increasing</label>
          </div>

          <!-- Q8 numeric -->
          <div class="q" data-type="num" data-answer="2.5,5/2" data-tol="0.001" data-points="1">
            <h5>8) \(\displaystyle \lim_{x\to\infty} \frac{5x^2+3}{2x^2-x}\) = ?</h5>
            <input class="input" placeholder="e.g., 2.5 or 5/2" />
            <div class="solution mt-8">Leading coefficients ratio ‚áí 5/2.</div>
          </div>

          <!-- Q9 short -->
          <div class="q" data-type="short" data-answer="squeeze,sandwich" data-accept="squeeze theorem,sandwich theorem" data-points="1">
            <h5>9) The theorem used to show \(\lim_{x\to 0} \frac{\sin x}{x}=1\) is the ______ theorem.</h5>
            <input class="input" placeholder="Type the name" />
            <div class="solution mt-8">The <strong>Squeeze</strong> (Sandwich) Theorem.</div>
          </div>

          <!-- Q10 MC -->
          <div class="q" data-type="mc" data-points="1">
            <h5>10) \(\lim_{x\to 0^+} \ln x\) equals‚Ä¶</h5>
            <label class="choice"><input type="radio" name="q10"> 0</label>
            <label class="choice" data-correct="true"><input type="radio" name="q10"> \(-\infty\)</label>
            <label class="choice"><input type="radio" name="q10"> DNE but finite</label>
          </div>

          <!-- Q11 numeric -->
          <div class="q" data-type="num" data-answer="2" data-tol="0.001" data-points="1">
            <h5>11) \(\displaystyle \lim_{x\to\infty} (\sqrt{x^2+4x}-x)\) = ?</h5>
            <input class="input" placeholder="Enter a number" />
            <div class="solution mt-8">Rationalize ‚Üí tends to <strong>2</strong>.</div>
          </div>

          <!-- Q12 short -->
          <div class="q" data-type="short" data-answer="removable" data-accept="hole,removable discontinuity" data-points="1">
            <h5>12) A ‚Äúhole‚Äù in the graph at a point is a ______ discontinuity.</h5>
            <input class="input" placeholder="Type the type" />
            <div class="solution mt-8">That‚Äôs a <strong>removable</strong> discontinuity.</div>
          </div>

          <div class="quiz-results">
            <div class="score-display">Your Score: <span id="scoreSpan">‚Äî</span>/12</div>
            <div class="flex center" style="justify-content:center;gap:12px">
              <button class="btn" onclick="submitQuiz()"><i class="fa-solid fa-check"></i> Submit Quiz</button>
              <button class="btn secondary" onclick="revealAllSolutions()"><i class="fa-solid fa-eye"></i> Reveal All Solutions</button>
              <button class="btn outline" onclick="resetQuiz()"><i class="fa-solid fa-rotate"></i> Reset Quiz</button>
            </div>
          </div>
        </section>

        <div class="footer-nav">
          <button class="btn outline" id="prevBtn">‚Üê Prev</button>
          <div class="right"><small>Progress saves in your browser</small></div>
          <button class="btn" id="nextBtn">Next ‚Üí</button>
        </div>
      </main>
    </div>
  </div>

  <!-- MathJax for TeX rendering -->
  <script>
    window.MathJax = { tex: { inlineMath: [['\\(','\\)'],['$','$']] } };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <script>
    // ======== SPA Controls ========
    const overviewPage = document.getElementById('overviewPage');
    const unitPage = document.getElementById('unitPage');

    function openUnit(n){
      // only Unit 1 is fully implemented; others are placeholders
      overviewPage.classList.add('hidden');
      unitPage.classList.add('active');
      // ensure first lesson visible
      setActiveLesson('l1');
      updateProgressUI();
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function backToOverview(){
      unitPage.classList.remove('active');
      overviewPage.classList.remove('hidden');
      window.scrollTo({top:0, behavior:'smooth'});
    }

    // ======== Lessons Navigation ========
    const lessonList = document.getElementById('lessonList');
    const lessonContainer = document.getElementById('lessonContainer');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    lessonList.addEventListener('click', (e)=>{
      const a = e.target.closest('a.lesson');
      if(!a) return;
      e.preventDefault();
      setActiveLesson(a.dataset.target);
    });

    function getAllLessonIds(){
      return Array.from(lessonList.querySelectorAll('a.lesson')).map(a=>a.dataset.target);
    }

    function getCurrentLessonId(){
      return lessonList.querySelector('a.lesson.active')?.dataset.target;
    }

    function setActiveLesson(id){
      // toggle sidebar state
      lessonList.querySelectorAll('a.lesson').forEach(a=>{
        a.classList.toggle('active', a.dataset.target===id);
      });
      // toggle main sections
      lessonContainer.querySelectorAll('section').forEach(sec=>{
        sec.hidden = (sec.id!==id);
      });
      // nav buttons
      const ids = getAllLessonIds();
      const idx = ids.indexOf(id);
      prevBtn.disabled = idx<=0;
      nextBtn.disabled = idx>=ids.length-1;
      prevBtn.onclick = ()=> setActiveLesson(ids[idx-1]);
      nextBtn.onclick = ()=> setActiveLesson(ids[idx+1]);
      // mark viewed as completed (except quiz until passed)
      if(id!=='quiz') markCompleted(id);
      updateProgressUI();
      // Re-typeset math in the activated section
      if(window.MathJax && window.MathJax.typesetPromise){
        MathJax.typesetPromise([document.getElementById(id)]);
      }
    }

    // ======== Toggle Solution ========
    function toggleSolution(btn){
      const sol = btn.parentElement.querySelector('.solution');
      if(!sol) return;
      sol.style.display = (sol.style.display==='block') ? 'none' : 'block';
      if(window.MathJax && window.MathJax.typesetPromise){ MathJax.typesetPromise([sol]); }
    }

    function revealAllSolutions(){
      document.querySelectorAll('#quiz .solution, .lesson-content .solution').forEach(el=>{ el.style.display='block'; });
    }

    // ======== Progress (localStorage) ========
    const STORAGE_KEY = 'ml-calc1-progress-v2';
    const QUIZ_KEY = 'ml-calc1-quiz-v2';

    function getProgress(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {completed:{}, quizScore:null}; } catch { return {completed:{}, quizScore:null}; }
    }
    function saveProgress(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

    function markCompleted(id){
      const data = getProgress();
      data.completed[id] = true;
      saveProgress(data);
      // mark in sidebar
      const link = lessonList.querySelector(`a.lesson[data-target="${id}"]`);
      if(link) link.classList.add('completed');
    }

    function updateProgressUI(){
      const data = getProgress();
      const ids = getAllLessonIds().filter(id=>id!=='quiz');
      const done = ids.filter(id=>data.completed[id]);
      const pct = Math.round(100*done.length/ids.length);
      document.getElementById('progressBar').style.width = pct+'%';
      document.getElementById('progressText').textContent = pct+'%';
      // sync sidebar checkmarks
      lessonList.querySelectorAll('a.lesson').forEach(a=>{
        a.classList.toggle('completed', !!data.completed[a.dataset.target]);
      });
      // quiz score if exists
      const scoreSpan = document.getElementById('scoreSpan');
      if(scoreSpan && data.quizScore!=null){ scoreSpan.textContent = data.quizScore; }
    }

    function resetProgress(){
      localStorage.removeItem(STORAGE_KEY);
      localStorage.removeItem(QUIZ_KEY);
      lessonList.querySelectorAll('a.lesson').forEach(a=>a.classList.remove('completed'));
      updateProgressUI();
      alert('Progress reset for Unit 1.');
    }

    // ======== Quiz Logic ========
    function normalizeFracOrNum(str){
      if(!str) return null;
      const s = String(str).trim().toLowerCase();
      if(/^[+-]?\d+(\.\d+)?$/.test(s)) return parseFloat(s);
      if(/^[+-]?\d+\s*\/\s*\d+$/.test(s)){
        const [a,b] = s.split('/').map(t=>parseFloat(t));
        if(!isNaN(a) && !isNaN(b) && b!==0) return a/b;
      }
      return s; // return raw for words / phrases
    }

    function checkMC(q){
      const correct = q.querySelector('.choice[data-correct="true"] input');
      const chosen = q.querySelector('input[type="radio"]:checked');
      const isRight = !!chosen && chosen===correct;
      return {ok:isRight};
    }

    function checkNum(q){
      const ansAttr = q.dataset.answer || '';
      const tol = parseFloat(q.dataset.tol || '0.000001');
      const input = q.querySelector('input');
      const given = normalizeFracOrNum(input.value);
      const candidates = ansAttr.split(',').map(a=>normalizeFracOrNum(a));
      let ok = false;
      for(const c of candidates){
        if(typeof c==='number' && typeof given==='number' && Math.abs(given-c) <= tol){ ok = true; break; }
        if(typeof c==='string' && typeof given==='string' && c===given){ ok = true; break; }
      }
      return {ok};
    }

    function checkShort(q){
      const ans = (q.dataset.answer||'').split(',').map(s=>s.trim().toLowerCase());
      const accept = (q.dataset.accept||'').split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);
      const all = new Set([...ans, ...accept]);
      const val = (q.querySelector('input').value||'').trim().toLowerCase();
      // allow minor variations
      const cleaned = val.replace(/\s+/g,' ');
      let ok=false;
      for(const a of all){
        if(!a) continue;
        if(cleaned===a) { ok=true; break; }
        // contains match if short keyword like 'dne' or 'squeeze'
        if(a.length>=3 && cleaned.includes(a)) { ok=true; break; }
      }
      return {ok};
    }

    function submitQuiz(){
      const qs = Array.from(document.querySelectorAll('#quiz .q'));
      let score = 0; let total = 0;
      qs.forEach(q=>{
        const pts = parseInt(q.dataset.points||'1');
        let res = {ok:false};
        if(q.dataset.type==='mc') res = checkMC(q);
        if(q.dataset.type==='num') res = checkNum(q);
        if(q.dataset.type==='short') res = checkShort(q);
        total += pts;
        if(res.ok){ score += pts; q.classList.add('correct-pulse');
          q.querySelectorAll('.incorrect-answer').forEach(x=>x.remove());
        } else {
          const marker = document.createElement('div');
          marker.className = 'incorrect-answer mt-8';
          marker.textContent = 'Not quite ‚Äî check the solution.';
          q.appendChild(marker);
        }
      });
      document.getElementById('scoreSpan').textContent = score;
      const data = getProgress();
      data.quizScore = score; saveProgress(data);
      // mark quiz as completed if decent score
      if(score >= Math.ceil(total*0.7)) markCompleted('quiz');
      updateProgressUI();
    }

    function resetQuiz(){
      document.querySelectorAll('#quiz input').forEach(inp=>{ if(inp.type==='radio') inp.checked=false; else inp.value=''; });
      document.querySelectorAll('#quiz .incorrect-answer').forEach(el=>el.remove());
      document.getElementById('scoreSpan').textContent = '‚Äî';
      const data = getProgress(); data.quizScore = null; saveProgress(data);
      updateProgressUI();
    }

    // Initialize default visible section when page opens directly on unit
    document.addEventListener('DOMContentLoaded', ()=>{
      updateProgressUI();
    });
  </script>
</body>
</html>



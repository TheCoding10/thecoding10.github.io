<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MemoLearning â€” Precalculus</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ---------- GLOBAL VARIABLES ---------- */
:root {
  --indigo: #6366f1;
  --indigo-light: #818cf8;
  --indigo-dark: #4f46e5;
  --purple: #7c3aed;
  --purple-light: #8b5cf6;
  --purple-dark: #6d28d9;
  --slate: #0f172a;
  --slate-light: #334155;
  --muted: #475569;
  --muted-light: #94a3b8;
  --card: #ffffff;
  --card-alt: #f8fafc;
  --success: #10b981;
  --success-light: #d1fae5;
  --warning: #f59e0b;
  --warning-light: #fef3c7;
  --danger: #ef4444;
  --danger-light: #fee2e2;
  --info: #3b82f6;
  --info-light: #dbeafe;
  --radius-sm: 6px;
  --radius: 12px;
  --radius-lg: 18px;
  --radius-xl: 24px;
  --shadow-sm: 0 4px 6px rgba(0,0,0,0.05);
  --shadow: 0 10px 25px rgba(0,0,0,0.1);
  --shadow-lg: 0 20px 40px rgba(0,0,0,0.15);
  --transition: all 0.3s ease;
}

/* ---------- GLOBAL STYLES ---------- */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  height: 100%;
  scroll-behavior: smooth;
}

body {
  font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--slate);
  background: linear-gradient(135deg, #667eea 0%, #7c3aed 100%) fixed;
  line-height: 1.6;
}

/* ---------- TYPOGRAPHY ---------- */
h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
  line-height: 1.2;
  margin-bottom: 0.5em;
}

/* ---------- BUTTONS ---------- */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  background: var(--indigo);
  color: #fff;
  border: none;
  padding: 10px 18px;
  border-radius: var(--radius);
  cursor: pointer;
  font-weight: 500;
  transition: var(--transition);
  box-shadow: var(--shadow-sm);
}

.btn:hover {
  background: var(--indigo-dark);
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.btn.secondary {
  background: var(--slate);
}

.btn.secondary:hover {
  background: #1e293b;
}

.btn.outline {
  background: transparent;
  border: 2px solid var(--indigo);
  color: var(--indigo);
}

.btn.outline:hover {
  background: var(--indigo);
  color: white;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.btn i {
  font-size: 0.9em;
}

/* ---------- OVERVIEW PAGE ---------- */
.overview-page {
  display: block;
  min-height: 100vh;
}

.overview-page.hidden {
  display: none;
}

.overview-header {
  background: rgba(255, 255, 255, 0.10);
  backdrop-filter: blur(20px);
  color: #fff;
  padding: 60px 20px;
  text-align: center;
  border-bottom: 1px solid rgba(255, 255, 255, 0.25);
}

.overview-header h1 {
  margin: 0;
  font-weight: 800;
  font-size: 48px;
  text-shadow: 0 2px 20px rgba(0, 0, 0, 0.35);
  letter-spacing: -0.5px;
}

.overview-header p {
  margin: 16px 0 0;
  font-size: 20px;
  opacity: 0.95;
  font-weight: 300;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 40px 20px;
}

.curriculum-stats {
  background: rgba(255, 255, 255, 0.10);
  backdrop-filter: blur(18px);
  border-radius: var(--radius-xl);
  padding: 32px;
  color: #fff;
  margin-bottom: 32px;
  box-shadow: var(--shadow);
}

.curriculum-stats h2 {
  margin: 0 0 20px 0;
  font-size: 28px;
  font-weight: 700;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 24px;
}

.stat-item {
  text-align: center;
  padding: 16px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: var(--radius-lg);
  transition: var(--transition);
}

.stat-item:hover {
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-3px);
}

.stat-number {
  font-size: 42px;
  font-weight: 800;
  display: block;
  margin-bottom: 4px;
  background: linear-gradient(135deg, #fff, #e0e7ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.stat-label {
  opacity: 0.9;
  font-size: 16px;
}

.units-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: 28px;
}

.unit-card {
  position: relative;
  background: rgba(255, 255, 255, 0.98);
  border: 1px solid rgba(255, 255, 255, 0.4);
  border-radius: var(--radius-xl);
  padding: 28px;
  box-shadow: var(--shadow);
  cursor: pointer;
  overflow: hidden;
  transition: var(--transition);
}

.unit-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background: linear-gradient(90deg, var(--indigo), var(--purple));
}

.unit-card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-lg);
}

.unit-header {
  display: flex;
  align-items: center;
  margin-bottom: 14px;
}

.unit-number {
  width: 42px;
  height: 42px;
  border-radius: 999px;
  background: linear-gradient(135deg, var(--indigo), var(--purple));
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
  margin-right: 16px;
  flex-shrink: 0;
}

.unit-title {
  margin: 0;
  font-weight: 700;
  font-size: 22px;
  color: var(--slate);
}

.unit-description {
  color: var(--muted);
  margin: 8px 0 16px;
  font-size: 15px;
}

.topics-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.topics-list li {
  position: relative;
  padding: 10px 0 10px 24px;
  border-bottom: 1px solid #f1f5f9;
  color: var(--slate-light);
  transition: var(--transition);
}

.topics-list li:hover {
  background: #f8fafc;
  padding-left: 28px;
}

.topics-list li:last-child {
  border-bottom: none;
}

.topics-list li::before {
  content: 'â–¸';
  position: absolute;
  left: 8px;
  color: var(--indigo);
  font-weight: 700;
}

.optional-badge {
  background: linear-gradient(135deg, var(--warning), #d97706);
  color: #fff;
  font-size: 12px;
  font-weight: 700;
  border-radius: 999px;
  padding: 4px 10px;
  margin-left: 10px;
  box-shadow: var(--shadow-sm);
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(22px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.unit-card {
  opacity: 0;
  animation: fadeInUp 0.6s ease forwards;
}

/* ---------- UNIT PAGE ---------- */
.unit-page {
  display: none;
  min-height: 100vh;
}

.unit-page.active {
  display: block;
}

.unit-header-stick {
  position: sticky;
  top: 0;
  z-index: 50;
  background: rgba(255, 255, 255, 0.10);
  backdrop-filter: saturate(1.15) blur(8px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.25);
  color: #fff;
  padding: 16px 20px;
}

.unit-header-stick .wrap {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  gap: 16px;
  align-items: center;
}

.unit-header-stick h1 {
  margin: 0;
  font-size: 24px;
  font-weight: 700;
}

.unit-header-stick .sub {
  opacity: 0.92;
  font-size: 15px;
}

.unit-header-stick .btn {
  margin-left: auto;
  background: rgba(255, 255, 255, 0.18);
  border: 1px solid rgba(255, 255, 255, 0.45);
  color: #fff;
  border-radius: 999px;
  padding: 8px 16px;
  cursor: pointer;
}

.unit-header-stick .btn:hover {
  background: rgba(255, 255, 255, 0.25);
}

.app {
  max-width: 1200px;
  margin: 24px auto;
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: 24px;
  padding: 0 20px;
}

aside {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow);
  overflow: hidden;
  align-self: start;
  position: sticky;
  top: 90px;
  max-height: calc(100vh - 120px);
  display: flex;
  flex-direction: column;
}

.side-head {
  padding: 20px;
  border-bottom: 1px solid #e5e7eb;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.12), rgba(124, 58, 237, 0.12));
}

.side-head h2 {
  margin: 0 0 12px 0;
  font-size: 18px;
  color: var(--slate);
}

.lesson-list {
  list-style: none;
  margin: 0;
  padding: 0;
  overflow: auto;
  flex-grow: 1;
}

.lesson-list li {
  border-bottom: 1px solid #eef2ff;
}

.lesson {
  display: flex;
  gap: 12px;
  padding: 14px 16px;
  text-decoration: none;
  color: inherit;
  cursor: pointer;
  align-items: center;
  transition: var(--transition);
}

.lesson:hover {
  background: #f8fafc;
}

.lesson.active {
  background: #eef2ff;
  border-left: 4px solid var(--indigo);
}

.tag {
  font-size: 11px;
  color: var(--indigo);
  font-weight: 700;
  background: #eef2ff;
  border-radius: 999px;
  padding: 4px 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.done {
  margin-left: auto;
  font-size: 12px;
  color: var(--success);
  font-weight: 700;
  display: none;
}

.lesson.completed .done {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

main {
  min-height: 70vh;
}

.card {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow);
  padding: 28px;
  margin-bottom: 24px;
}

.crumbs {
  color: var(--muted);
  font-size: 13px;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.crumbs span:not(:last-child)::after {
  content: '/';
  margin: 0 8px;
  color: var(--muted-light);
}

.title {
  margin: 4px 0 8px;
  font-size: 28px;
  font-weight: 800;
  color: var(--slate);
  line-height: 1.2;
}

.lead {
  color: var(--muted);
  margin: 0 0 16px;
  font-size: 17px;
  line-height: 1.5;
}

.content-block {
  margin-bottom: 20px;
}

.content-block p {
  margin-bottom: 16px;
  line-height: 1.7;
}

.example {
  border: 1px solid #c7d2fe;
  background: #eef2ff;
  padding: 18px 20px;
  border-radius: var(--radius);
  margin: 16px 0;
  position: relative;
}

.example h4 {
  margin: 0 0 8px;
  color: var(--indigo-dark);
  display: flex;
  align-items: center;
  gap: 8px;
}

.example h4 i {
  font-size: 18px;
}

.note {
  border-left: 4px solid var(--success);
  background: var(--success-light);
  padding: 16px 20px;
  border-radius: var(--radius);
  margin: 16px 0;
  display: flex;
  gap: 12px;
}

.note::before {
  content: 'ğŸ’¡';
  font-size: 18px;
  flex-shrink: 0;
}

.warn {
  border-left: 4px solid var(--warning);
  background: var(--warning-light);
  padding: 16px 20px;
  border-radius: var(--radius);
  margin: 16px 0;
  display: flex;
  gap: 12px;
}

.warn::before {
  content: 'âš ï¸';
  font-size: 18px;
  flex-shrink: 0;
}

.practice, .quiz {
  margin-top: 24px;
  padding-top: 24px;
  border-top: 1px dashed #e5e7eb;
}

.problem, .q {
  border: 1px solid #e5e7eb;
  border-radius: var(--radius-lg);
  background: var(--card-alt);
  padding: 20px;
  margin: 16px 0;
}

.problem h5, .q h5 {
  margin: 0 0 12px;
  font-size: 18px;
  color: var(--slate);
}

.choice {
  display: flex;
  gap: 12px;
  align-items: center;
  border: 1px solid #e5e7eb;
  border-radius: var(--radius);
  padding: 12px;
  margin: 8px 0;
  cursor: pointer;
  transition: var(--transition);
}

.choice:hover {
  background: #f1f5f9;
  border-color: var(--indigo-light);
}

.choice input[type="radio"] {
  accent-color: var(--indigo);
}

.input {
  padding: 12px 14px;
  border: 1px solid #cbd5e1;
  border-radius: var(--radius);
  width: 100%;
  max-width: 300px;
  font-family: inherit;
  font-size: 15px;
  transition: var(--transition);
}

.input:focus {
  outline: none;
  border-color: var(--indigo);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
}

.ok {
  color: #065f46;
  background: var(--success-light);
  border: 1px solid var(--success);
  padding: 12px 16px;
  border-radius: var(--radius);
  margin-top: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.bad {
  color: #991b1b;
  background: var(--danger-light);
  border: 1px solid var(--danger);
  padding: 12px 16px;
  border-radius: var(--radius);
  margin-top: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.help {
  color: var(--info);
  text-decoration: underline;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  margin-top: 12px;
  font-weight: 500;
}

.solution {
  display: none;
  padding: 16px;
  border: 1px dashed #93c5fd;
  background: var(--info-light);
  color: #1e3a8a;
  border-radius: var(--radius);
  margin-top: 12px;
  white-space: pre-line;
  line-height: 1.6;
}

.footer-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  margin-top: 24px;
  padding-top: 20px;
  border-top: 1px solid #e5e7eb;
}

.progress {
  height: 10px;
  border-radius: 999px;
  background: #eef2ff;
  overflow: hidden;
  margin-bottom: 12px;
}

.progress>span {
  display: block;
  height: 100%;
  background: linear-gradient(90deg, var(--indigo), var(--purple));
  width: 0%;
  border-radius: 999px;
  transition: width 0.5s ease;
}

.progress-text {
  font-size: 13px;
  color: var(--muted);
  text-align: right;
}

/* Math styling */
.math {
  font-family: 'Times New Roman', serif;
  font-style: italic;
}

.equation {
  background: #f8fafc;
  padding: 12px 16px;
  border-radius: var(--radius);
  margin: 12px 0;
  overflow-x: auto;
}

/* Quiz results */
.quiz-results {
  margin-top: 20px;
  padding: 20px;
  background: #f8fafc;
  border-radius: var(--radius);
  text-align: center;
}

.score-display {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 16px;
  color: var(--indigo-dark);
}

.correct-answer {
  color: var(--success);
}

.incorrect-answer {
  color: var(--danger);
}

/* Responsive adjustments */
@media (max-width: 1024px) {
  .app {
    grid-template-columns: 1fr;
    gap: 20px;
  }
  
  aside {
    position: static;
    max-height: none;
  }
  
  .unit-header-stick .wrap {
    flex-wrap: wrap;
  }
  
  .units-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .overview-header {
    padding: 40px 20px;
  }
  
  .overview-header h1 {
    font-size: 36px;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .footer-nav {
    flex-direction: column;
    align-items: stretch;
  }
  
  .footer-nav .btn {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .unit-card {
    padding: 20px;
  }
  
  .card {
    padding: 20px;
  }
}

/* Animation for correct/incorrect answers */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.03); }
  100% { transform: scale(1); }
}

.correct-pulse {
  animation: pulse 0.5s ease;
}

/* Code block styling */
.code-block {
  background: #1e293b;
  color: #e2e8f0;
  padding: 16px;
  border-radius: var(--radius);
  margin: 16px 0;
  overflow-x: auto;
  font-family: 'Fira Code', monospace;
  font-size: 14px;
}

/* Highlight box */
.highlight {
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(124, 58, 237, 0.1));
  border-left: 4px solid var(--indigo);
  padding: 20px;
  border-radius: var(--radius);
  margin: 20px 0;
}

.highlight h4 {
  margin-top: 0;
  color: var(--indigo-dark);
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Definition box */
.definition {
  background: #f0f9ff;
  border-left: 4px solid var(--info);
  padding: 20px;
  border-radius: var(--radius);
  margin: 20px 0;
}

.definition h4 {
  margin-top: 0;
  color: var(--info);
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Key takeaways */
.key-takeaways {
  background: #ecfdf5;
  border: 1px solid #a7f3d0;
  border-radius: var(--radius);
  padding: 20px;
  margin: 20px 0;
}

.key-takeaways h4 {
  margin-top: 0;
  color: var(--success);
  display: flex;
  align-items: center;
  gap: 8px;
}

.key-takeaways ul {
  padding-left: 20px;
  margin-bottom: 0;
}

.key-takeaways li {
  margin-bottom: 8px;
}

.key-takeaways li:last-child {
  margin-bottom: 0;
}
</style>
</head>
<body>

<!-- ================= OVERVIEW ================= -->
<div class="overview-page" id="overviewPage">
  <header class="overview-header">
    <h1><i class="fas fa-graduation-cap"></i> MemoLearning Precalculus</h1>
    <p>Master precalculus with our comprehensive curriculum featuring interactive lessons, practice problems, and quizzes</p>
  </header>

  <div class="container">
    <div class="curriculum-stats">
      <h2>Curriculum Overview</h2>
      <div class="stats-grid">
        <div class="stat-item"><span class="stat-number">10</span><div class="stat-label">Total Units</div></div>
        <div class="stat-item"><span class="stat-number">~131</span><div class="stat-label">Skills to Master</div></div>
        <div class="stat-item"><span class="stat-number">8</span><div class="stat-label">Core Units</div></div>
        <div class="stat-item"><span class="stat-number">2</span><div class="stat-label">Optional Units</div></div>
      </div>
    </div>

    <div class="units-grid">
      <!-- Cards 1-10 -->
      <div class="unit-card" style="animation-delay:0s" onclick="openUnit(1)">
        <div class="unit-header"><div class="unit-number">1</div><h3 class="unit-title">Composite and Inverse Functions</h3></div>
        <p class="unit-description">Master function composition, domains/ranges, and finding inverse functions.</p>
        <ul class="topics-list">
          <li>Function composition (fâˆ˜g)(x)</li><li>Domains/ranges under composition</li><li>One-to-one functions & horizontal line test</li>
          <li>Inverse functions: definition, notation, verification</li><li>Restricting domains to create inverses</li><li>Solving equations with inverses</li>
        </ul>
      </div>

      <div class="unit-card" style="animation-delay:.05s" onclick="openUnit(2)">
        <div class="unit-header"><div class="unit-number">2</div><h3 class="unit-title">Trigonometry</h3></div>
        <p class="unit-description">Deep dive into trig functions, identities, equations, and their graphs.</p>
        <ul class="topics-list">
          <li>Angle measure (degrees â†” radians) & arc length</li><li>Unit circle values & reference angles</li><li>Trig functions as coordinates on unit circle</li>
          <li>Graphs of sine, cosine, tangent</li><li>Trig identities (Pythagorean, reciprocal, quotient)</li><li>Sum & difference identities</li><li>Inverse trig functions</li><li>Law of sines & law of cosines</li>
        </ul>
      </div>

      <div class="unit-card" style="animation-delay:.10s" onclick="openUnit(3)">
        <div class="unit-header"><div class="unit-number">3</div><h3 class="unit-title">Complex Numbers</h3></div>
        <p class="unit-description">Work with a+bi algebraically and geometrically, including polar form.</p>
        <ul class="topics-list">
          <li>Imaginary unit i and powers of i</li><li>Adding, subtracting, multiplying, dividing</li><li>Complex conjugates & modulus</li>
          <li>Graphing in the complex plane</li><li>Polar form r(cosÎ¸+isinÎ¸)</li><li>De Moivre's theorem & complex roots</li>
        </ul>
      </div>

      <div class="unit-card" style="animation-delay:.15s" onclick="openUnit(4)">
        <div class="unit-header"><div class="unit-number">4</div><h3 class="unit-title">Rational Functions</h3></div>
        <p class="unit-description">Analyze, simplify, and graph rational expressions and functions.</p>
        <ul class="topics-list">
          <li>Domains, intercepts, and holes</li><li>Vertical, horizontal, and slant asymptotes</li><li>End behavior and limits</li>
          <li>Graphing rational functions</li><li>Simplifying rational expressions</li><li>Partial fraction decomposition</li>
        </ul>
      </div>

      <div class="unit-card" style="animation-delay:.20s" onclick="openUnit(5)">
        <div class="unit-header"><div class="unit-number">5</div><h3 class="unit-title">Conic Sections</h3></div>
        <p class="unit-description">Circles, ellipses, parabolas, and hyperbolas from algebraic and geometric viewpoints.</p>
        <ul class="topics-list">
          <li>General vs. standard forms</li><li>Parabolas: vertex, focus/directrix form</li><li>Ellipses: center, axes, foci, eccentricity</li>
          <li>Hyperbolas: axes, asymptotes, foci</li><li>Circles: center-radius form</li><li>Graphing and extracting features</li>
        </ul>
      </div>

      <div class="unit-card" style="animation-delay:.25s" onclick="openUnit(6)">
        <div class="unit-header"><div class="unit-number">6</div><h3 class="unit-title">Vectors</h3></div>
        <p class="unit-description">Algebraic & geometric operations, dot product, and applications.</p>
        <ul class="topics-list">
          <li>Magnitude & direction; unit vectors</li><li>Component form vs. magnitudeâ€“direction form</li><li>Adding, subtracting, and scaling vectors</li><li>Dot product & angle between vectors</li><li>Word problems: forces, velocity, navigation</li>
        </ul>
      </div>

      <div class="unit-card" style="animation-delay:.30s" onclick="openUnit(7)">
        <div class="unit-header"><div class="unit-number">7</div><h3 class="unit-title">Matrices</h3></div>
        <p class="unit-description">Matrix arithmetic and using matrices to solve systems & model transformations.</p>
        <ul class="topics-list">
          <li>Matrix addition, subtraction, scalar multiplication</li><li>Matrix multiplication & properties</li><li>Determinants & inverses (2Ã—2 focus)</li><li>Solving linear systems with matrices</li><li>Transformations of vectors with matrices</li>
        </ul>
      </div>

      <div class="unit-card" style="animation-delay:.35s" onclick="openUnit(8)">
        <div class="unit-header"><div class="unit-number">8</div><h3 class="unit-title">Probability & Combinatorics</h3></div>
        <p class="unit-description">Counting methods and probability structures, including expected value.</p>
        <ul class="topics-list">
          <li>Basic probability rules</li><li>Permutations & combinations (nPr, nCr)</li><li>Binomial coefficients & Pascal's triangle</li>
          <li>Probability distributions</li><li>Expected value & decision making</li>
        </ul>
      </div>

      <div class="unit-card" style="animation-delay:.40s" onclick="openUnit(9)">
        <div class="unit-header"><div class="unit-number">9</div><h3 class="unit-title">Series</h3><span class="optional-badge">Optional</span></div>
        <p class="unit-description">Arithmetic & geometric sequences/series, sigma notation, and binomial theorem.</p>
        <ul class="topics-list">
          <li>Sequences (explicit vs. recursive)</li><li>Arithmetic series: partial sums</li><li>Geometric series: finite & infinite sums</li><li>Sigma (Î£) notation manipulation</li><li>Binomial theorem & combinatorics connection</li>
        </ul>
      </div>

      <div class="unit-card" style="animation-delay:.45s" onclick="openUnit(10)">
        <div class="unit-header"><div class="unit-number">10</div><h3 class="unit-title">Limits & Continuity</h3><span class="optional-badge">Optional</span></div>
        <p class="unit-description">Bridge to Calculus: introduce the language and intuition of limits.</p>
        <ul class="topics-list">
          <li>Limit notation & evaluating basic limits</li><li>One-sided & infinite limits</li><li>Continuity at a point and on intervals</li><li>Piecewise functions & discontinuities</li><li>Using limits to describe end behavior</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- ================= GENERIC UNIT PAGE ================= -->
<div class="unit-page" id="unitPage">
  <header class="unit-header-stick">
    <div class="wrap">
      <h1><i class="fas fa-book"></i> MemoLearning â€” Precalculus</h1>
      <div class="sub" id="unitSub">Unit â€¢ â€¦</div>
      <button class="btn" onclick="backToOverview()"><i class="fas fa-arrow-left"></i> Back to Overview</button>
    </div>
  </header>

  <div class="app">
    <aside>
      <div class="side-head">
        <h2 id="sideTitle">Lessons</h2>
        <div class="progress" title="Progress"><span id="progressbar"></span></div>
        <div class="progress-text" id="progressText">0% Complete</div>
      </div>
      <ul class="lesson-list" id="lessonList"></ul>
    </aside>

    <main>
      <div class="card" id="article">
        <div class="crumbs" id="crumbs">
          <span>Unit</span>
          <span>Section</span>
          <span>Page</span>
        </div>
        <h2 class="title" id="title">Title</h2>
        <p class="lead" id="lead">Lead sentence.</p>
        <div id="content"></div>
        <div class="practice" id="practice"></div>
        <div class="quiz" id="quiz"></div>
        <div class="footer-nav">
          <button class="btn secondary" id="prevBtn"><i class="fas fa-arrow-left"></i> Previous</button>
          <div style="flex:1"></div>
          <button class="btn" id="nextBtn">Up next <i class="fas fa-arrow-right"></i></button>
        </div>
      </div>
    </main>
  </div>
</div>

<script>
/* =================== DATA: UNITS 1â€“10 =================== */
const UNITS = {
  1: { // Detailed Unit 1
    id:'u1', title:'Composite and Inverse Functions',
    sections:[
      { id:'composition', title:'Function Composition',
        pages:[
          { id:'theory', label:'Theory', tag:'Article', blocks:[
            {type:'p', text:'Given functions g: X â†’ Y and f: Y â†’ Z, the composition fâˆ˜g maps X to Z by x â†¦ f(g(x)). Composition is associative but generally not commutative.'},
            {type:'definition', title:'Function Composition', text:'The composition of two functions f and g is defined as (fâˆ˜g)(x) = f(g(x)), where the output of g becomes the input of f.'},
            {type:'note', text:'Domain rule: Dom(fâˆ˜g) = { x âˆˆ Dom(g) | g(x) âˆˆ Dom(f) }.'},
            {type:'ex', title:'Nonâ€‘commutativity Example', text:'Let f(x)=2x+1 and g(x)=xâˆ’3. Then (fâˆ˜g)(x)=2xâˆ’5 while (gâˆ˜f)(x)=2xâˆ’2.'},
            {type:'highlight', title:'Key Insight', text:'The order of composition matters! fâˆ˜g is generally different from gâˆ˜f.'},
            {type:'warn', text:'Make sure the codomain of g matches the domain of f; otherwise fâˆ˜g is undefined.'}
          ]},
          { id:'decompose', label:'Decomposition', tag:'Article', blocks:[
            {type:'p', text:'To analyze a complicated function F, we can often factor it as F = fâˆ˜g. Choose g to isolate an inner structure (affine change, power, exponential, logarithm), and f to complete the mapping.'},
            {type:'ex', title:'Decomposition Example', text:'F(x)=âˆš(5x+7). One valid decomposition: f(u)=âˆšu, g(x)=5x+7. Another: f(u)=âˆš(5u+7), g(x)=x.'},
            {type:'key-takeaways', title:'Key Takeaways', text:['Decomposition helps understand complex functions','Multiple decompositions are often possible','Choose the decomposition that simplifies your analysis']}
          ]},
          { id:'evaluate', label:'Evaluate fâˆ˜g', tag:'Practice', blocks:[{type:'p', text:'To evaluate a composition, compute g(x), substitute into f, simplify, then apply the domain rule.'}],
            practice:[
              {id:'u1_c1', kind:'numeric', prompt:'f(x)=3xâˆ’2, g(x)=xÂ². Compute (fâˆ˜g)(3).', ans:25, tol:1e-3, sol:'First compute g(3)=9, then f(9)=27âˆ’2=25.'},
              {id:'u1_c2', kind:'numeric', prompt:'f(x)=âˆšx, g(x)=xâˆ’5. Evaluate (fâˆ˜g)(14).', ans:3, tol:1e-3, sol:'First compute g(14)=9, then f(9)=âˆš9=3.'},
              {id:'u1_c3', kind:'mc', prompt:'Which is a valid decomposition of H(x)=(3xâˆ’1)â´?', options:['f(u)=uâ´, g(x)=3xâˆ’1','f(u)=3uâˆ’1, g(x)=xâ´','f(u)=uÂ², g(x)=(3xâˆ’1)Â²'], correct:0, sol:'The power function is applied after the affine transformation.'}
            ]
          },
          { id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
            {id:'u1_q1', q:'If f(x)=5âˆ’x and g(x)=xÂ², then (fâˆ˜g)(x)=', opts:['5 âˆ’ x âˆ’ xÂ²','5 âˆ’ xÂ²','(5 âˆ’ x)Â²'], a:1, exp:'Substitute g(x) into f: f(g(x)) = 5 âˆ’ (xÂ²) = 5 âˆ’ xÂ².'},
            {id:'u1_q2', q:'The domain of fâˆ˜g equals', opts:['Dom(f)âˆ©Dom(g)','{x âˆˆ Dom(g) | g(x) âˆˆ Dom(f)}','Ran(g)'], a:1, exp:'x must be in the domain of g, and g(x) must be in the domain of f.'},
            {id:'u1_q3', q:'If f(x)=2x+3 and g(x)=xâˆ’1, then (gâˆ˜f)(2)=', opts:['3','4','5'], a:1, exp:'f(2)=7, then g(7)=6.'}
          ]}
        ]},
      { id:'inverses', title:'Inverse Functions',
        pages:[
          { id:'theory', label:'Theory', tag:'Article', blocks:[
            {type:'p', text:'An inverse function fâ»Â¹ reverses the action of f: fâ»Â¹(f(x))=x and f(fâ»Â¹(y))=y. The graphs of f and fâ»Â¹ are symmetric with respect to the line y=x, and their domains and ranges are swapped.'},
            {type:'ex', title:'Finding an Inverse Function', text:'To find the inverse of f(x)=4x+3: 1) Replace f(x) with y: y=4x+3; 2) Swap x and y: x=4y+3; 3) Solve for y: y=(xâˆ’3)/4; 4) Replace y with fâ»Â¹(x): fâ»Â¹(x)=(xâˆ’3)/4.'},
            {type:'note', text:'Important: fâ»Â¹(x) does not mean 1/f(x). The âˆ’1 is notation for the inverse function, not an exponent.'},
            {type:'warn', text:'A function must be one-to-one (pass the horizontal line test) to have an inverse. If not, we may need to restrict its domain.'}
          ]},
          { id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Practice finding and using inverse functions with these problems.'}],
            practice:[
              {id:'u1_i1', kind:'mc', prompt:'If f(x)=4x+3, then fâ»Â¹(x)=', options:['(xâˆ’3)/4','(x+3)/4','4xâˆ’3'], correct:0, sol:'Solve x=4y+3 for y: y=(xâˆ’3)/4.'},
              {id:'u1_i2', kind:'numeric', prompt:'If f(x)=5xâˆ’7, compute fâ»Â¹(18).', ans:5, tol:1e-3, sol:'Set 5yâˆ’7=18, then solve: 5y=25, y=5.'},
              {id:'u1_i3', kind:'mc', prompt:'Which function has an inverse?', options:['f(x)=xÂ²','f(x)=sin(x)','f(x)=2x+5'], correct:2, sol:'Linear functions (except constant ones) are one-to-one and have inverses.'}
            ]
          }
        ]}
    ]
  },

  /* === Unit 2: Trigonometry === */
  2:{id:'u2', title:'Trigonometry', sections:[
    {id:'angles', title:'Angle Measure & Arc Length', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Radians provide a natural way to measure angles based on arc length: Î¸ = s/r, where s is arc length and r is radius. 180Â° = Ï€ radians. The area of a circular sector is A = 1/2 rÂ²Î¸ (with Î¸ in radians).'},
        {type:'ex', title:'Arc Length Example', text:'For a circle with radius r = 4 and central angle Î¸ = Ï€/3, the arc length is s = rÎ¸ = 4 Ã— Ï€/3 = 4Ï€/3.'},
        {type:'highlight', title:'Conversion Formula', text:'To convert between degrees and radians: radians = degrees Ã— Ï€/180, degrees = radians Ã— 180/Ï€.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Practice converting between degrees and radians and computing arc lengths and sector areas.'}], practice:[
        {id:'t2p1', kind:'mc', prompt:'150Â° in radians =', options:['2Ï€/3','5Ï€/6','7Ï€/6','3Ï€/4'], correct:1, sol:'150/180 = 5/6 of Ï€, so 5Ï€/6.'},
        {id:'t2p2', kind:'numeric', prompt:'Find the area of a sector with radius r=3 and angle Î¸=Ï€/2.', ans: (9*Math.PI/4), tol:0.02, sol:'A = 1/2 rÂ²Î¸ = 1/2 Ã— 9 Ã— Ï€/2 = 9Ï€/4 â‰ˆ 7.069.'},
        {id:'t2p3', kind:'numeric', prompt:'Convert 5Ï€/4 radians to degrees.', ans:225, tol:1e-3, sol:'5Ï€/4 Ã— 180/Ï€ = 225Â°.'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'t2q1', q:'cos(Ï€) =', opts:['1','0','âˆ’1'], a:2, exp:'At Ï€ radians (180Â°), the cosine value is âˆ’1.'},
        {id:'t2q2', q:'Convert Ï€/4 to degrees', opts:['30Â°','45Â°','60Â°'], a:1, exp:'Ï€/4 Ã— 180/Ï€ = 45Â°.'},
        {id:'t2q3', q:'An angle of 270Â° is equivalent to', opts:['3Ï€/2','2Ï€/3','5Ï€/4'], a:0, exp:'270/180 = 3/2, so 3Ï€/2 radians.'}
      ]}
    ]},
    {id:'unitcircle', title:'Unit Circle & Reference Angles', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'On the unit circle (radius = 1), a point at angle Î¸ has coordinates (cosÎ¸, sinÎ¸). Reference angles help find trigonometric values in all quadrants by relating them to values in the first quadrant.'},
        {type:'ex', title:'Using Reference Angles', text:'To find sin(150Â°), note that 150Â° is in QII with reference angle 30Â°. Since sine is positive in QII, sin(150Â°) = sin(30Â°) = 1/2.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Use the unit circle and reference angles to find exact trigonometric values.'}], practice:[
        {id:'t2p3', kind:'mc', prompt:'sin(Ï€/6)=', options:['1','âˆš3/2','1/2','0'], correct:2, sol:'Standard exact value from the unit circle.'},
        {id:'t2p4', kind:'mc', prompt:'cos(2Ï€/3)=', options:['1/2','âˆ’1/2','âˆ’âˆš3/2','âˆš3/2'], correct:1, sol:'2Ï€/3 is in QII with reference angle Ï€/3, and cosine is negative in QII.'},
        {id:'t2p5', kind:'mc', prompt:'tan(225Â°)=', options:['1','âˆ’1','âˆš3','0'], correct:0, sol:'225Â° is in QIII with reference angle 45Â°, and tan(45Â°)=1, positive in QIII.'}
      ]}
    ]},
    {id:'graphs', title:'Graphs of sin, cos, tan', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'The general form for sinusoidal functions is y = AÂ·sin(B(xâˆ’C)) + D, where |A| is the amplitude, 2Ï€/|B| is the period, C is the phase shift, and D is the vertical shift.'},
        {type:'ex', title:'Graph Characteristics', text:'For y = 3sin(2(xâˆ’Ï€/4)) + 1: amplitude = 3, period = Ï€, phase shift = Ï€/4 right, vertical shift = 1 up.'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'t2q3', q:'The period of y=sin(3x) is', opts:['2Ï€','2Ï€/3','3Ï€'], a:1, exp:'Period = 2Ï€/|B| = 2Ï€/3.'},
        {id:'t2q4', q:'The amplitude of y=âˆ’4cos(x) is', opts:['âˆ’4','2','4'], a:2, exp:'Amplitude is always positive = |âˆ’4| = 4.'}
      ]}
    ]},
    {id:'ids', title:'Trig Identities', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Key trigonometric identities include: Pythagorean (sinÂ²x+cosÂ²x=1), reciprocal (cscx=1/sinx, secx=1/cosx, cotx=1/tanx), and quotient (tanx=sinx/cosx, cotx=cosx/sinx).'},
        {type:'ex', title:'Using Identities', text:'If sinx=3/5 and x is in QII, then cosx=âˆ’4/5 (using sinÂ²x+cosÂ²x=1), and tanx=sinx/cosx=âˆ’3/4.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Simplify expressions and verify identities using trigonometric identities.'}], practice:[
        {id:'t2p5', kind:'mc', prompt:'Simplify sinÂ²x+cosÂ²x', options:['0','1','2'], correct:1, sol:'Fundamental Pythagorean identity.'},
        {id:'t2p6', kind:'mc', prompt:'Express tanx in terms of sinx and cosx', options:['sinx/cosx','cosx/sinx','1/sinx'], correct:0, sol:'Definition of tangent.'}
      ]}]
    },
    {id:'sums', title:'Sum & Difference Identities', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Sum and difference identities: sin(Î±Â±Î²)=sinÎ±cosÎ²Â±cosÎ±sinÎ²; cos(Î±Â±Î²)=cosÎ±cosÎ²âˆ“sinÎ±sinÎ²; tan(Î±Â±Î²)=(tanÎ±Â±tanÎ²)/(1âˆ“tanÎ±tanÎ²).'},
        {type:'ex', title:'Exact Value Calculation', text:'cos(15Â°)=cos(45Â°âˆ’30Â°)=cos45Â°cos30Â°+sin45Â°sin30Â°=(âˆš2/2)(âˆš3/2)+(âˆš2/2)(1/2)=âˆš2(âˆš3+1)/4.'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'t2q4', q:'cos(Ï€/3+Ï€/6)=', opts:['âˆš3/2','1/2','0'], a:2, exp:'cos(Ï€/2)=0.'},
        {id:'t2q5', q:'sin(Ï€/2 âˆ’ x)=', opts:['cosx','sinx','âˆ’cosx'], a:0, exp:'Cofunction identity.'}
      ]}
    ]},
    {id:'inverse', title:'Inverse Trig Functions', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Inverse trigonometric functions have restricted ranges to make them functions: arcsinâˆˆ[âˆ’Ï€/2,Ï€/2], arccosâˆˆ[0,Ï€], arctanâˆˆ(âˆ’Ï€/2,Ï€/2).'},
        {type:'warn', text:'Remember that these functions return angles, and we must be careful about their restricted ranges.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Evaluate inverse trigonometric functions, remembering their principal ranges.'}], practice:[
        {id:'t2p6', kind:'mc', prompt:'arccos(âˆ’1)=', options:['0','Ï€','Ï€/2'], correct:1, sol:'Cosine equals âˆ’1 at Ï€ radians.'},
        {id:'t2p7', kind:'mc', prompt:'arcsin(1/2)=', options:['Ï€/6','Ï€/3','Ï€/4'], correct:0, sol:'sin(Ï€/6)=1/2 and Ï€/6 is in the range of arcsin.'}
      ]}]
    },
    {id:'laws', title:'Law of Sines & Cosines', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'For any triangle ABC: Law of Sines: a/sinA = b/sinB = c/sinC; Law of Cosines: cÂ² = aÂ² + bÂ² âˆ’ 2ab cosC.'},
        {type:'ex', title:'Application', text:'Use Law of Sines when you know two angles and a side, or two sides and a non-included angle. Use Law of Cosines when you know two sides and the included angle, or all three sides.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Solve triangles using the Law of Sines and Law of Cosines.'}], practice:[
        {id:'t2p7', kind:'mc', prompt:'In Î”ABC with a=b and C=60Â°, side c equals', options:['a','âˆš3 a','2a'], correct:0, sol:'By Law of Cosines: cÂ²=aÂ²+aÂ²âˆ’2aÂ²cos60Â°=2aÂ²âˆ’2aÂ²(0.5)=aÂ² â‡’ c=a.'},
        {id:'t2p8', kind:'mc', prompt:'For a triangle with a=7, b=24, c=25, the largest angle is', options:['acute','obtuse','right'], correct:2, sol:'Check with Law of Cosines: cosC=(7Â²+24Â²âˆ’25Â²)/(2Ã—7Ã—24)=0, so C=90Â°.'}
      ]}]
    }
  ]},

  /* === Unit 3: Complex Numbers === */
  3:{id:'u3', title:'Complex Numbers', sections:[
    {id:'algebra', title:'Algebra of a+bi', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Complex numbers have the form a+bi, where iÂ²=âˆ’1. Operations: (a+bi)+(c+di)=(a+c)+(b+d)i; (a+bi)(c+di)=(acâˆ’bd)+(ad+bc)i.'},
        {type:'note', text:'The modulus (absolute value) is |a+bi|=âˆš(aÂ²+bÂ²); the conjugate is aâˆ’bi; and zÂ·conjugate(z) = |z|Â².'},
        {type:'ex', title:'Multiplication Example', text:'(2+3i)(1âˆ’2i)=2Ã—1+2Ã—(âˆ’2i)+3iÃ—1+3iÃ—(âˆ’2i)=2âˆ’4i+3iâˆ’6iÂ²=2âˆ’iâˆ’6(âˆ’1)=8âˆ’i.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Perform arithmetic operations with complex numbers.'}], practice:[
        {id:'c3p1', kind:'numeric', prompt:'|(3âˆ’4i)| = ?', ans:5, tol:1e-3, sol:'âˆš(3Â²+(-4)Â²)=âˆš(9+16)=âˆš25=5.'},
        {id:'c3p2', kind:'mc', prompt:'(1+i)(1âˆ’i)=', options:['0','1','2'], correct:2, sol:'(1+i)(1âˆ’i)=1âˆ’iÂ²=1âˆ’(âˆ’1)=2.'},
        {id:'c3p3', kind:'mc', prompt:'The conjugate of 2âˆ’5i is', options:['âˆ’2+5i','2+5i','âˆ’2âˆ’5i'], correct:1, sol:'Change the sign of the imaginary part: 2+5i.'}
      ]}
    ]},
    {id:'polar', title:'Polar Form & De Moivre', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'The polar form of a complex number is z=r(cosÎ¸+i sinÎ¸), where r=|z| and Î¸=arg(z). De Moivre\'s Theorem: zâ¿=râ¿(cos nÎ¸ + i sin nÎ¸).'},
        {type:'ex', title:'De Moivre\'s Theorem', text:'To compute (1+i)â¸, first convert to polar: r=âˆš2, Î¸=Ï€/4, so (1+i)â¸=(âˆš2)â¸(cos(8Ã—Ï€/4)+i sin(8Ã—Ï€/4))=16(cos2Ï€+i sin2Ï€)=16.'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'c3q1', q:'For z=2(cos Ï€/3 + i sin Ï€/3), zÂ² has modulus', opts:['2','4','8'], a:1, exp:'Modulus squares: 2Â²=4.'},
        {id:'c3q2', q:'The argument of i is', opts:['0','Ï€/2','Ï€'], a:1, exp:'i is on the positive imaginary axis, so arg(i)=Ï€/2.'}
      ]}
    ]}
  ]},

  /* === Unit 4: Rational Functions === */
  4:{id:'u4', title:'Rational Functions', sections:[
    {id:'domain', title:'Domains, Holes, Asymptotes', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Vertical asymptotes occur at zeros of the denominator after simplification. Removable discontinuities (holes) occur where a common factor cancels from both numerator and denominator.'},
        {type:'ex', title:'Identifying Features', text:'For f(x)=(xÂ²âˆ’4)/(xâˆ’2), there is a hole at x=2 (after canceling (x-2)), but no vertical asymptote. For g(x)=(x+1)/(xâˆ’3), there is a vertical asymptote at x=3.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Analyze rational functions to find domains, holes, and asymptotes.'}], practice:[
        {id:'u4p1', kind:'mc', prompt:'f(x)=(xâˆ’1)/(xÂ²âˆ’1) has a hole at', options:['x=1','x=âˆ’1','both Â±1'], correct:0, sol:'Factor: (x-1)/((x-1)(x+1)). Cancel (x-1); hole at x=1, vertical asymptote at x=âˆ’1.'},
        {id:'u4p2', kind:'mc', prompt:'The domain of f(x)=1/(xÂ²+1) is', options:['xâ‰ Â±1','all real numbers','xâ‰ 0'], correct:1, sol:'The denominator xÂ²+1 is never zero for real x.'}
      ]}]
    },
    {id:'hslant', title:'Horizontal/Slant Asymptotes', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Horizontal asymptotes describe end behavior: if deg(num)<deg(den), HA: y=0; if deg(num)=deg(den), HA: y=ratio of leading coefficients; if deg(num)>deg(den), no HA (but possibly a slant asymptote).'},
        {type:'ex', title:'Slant Asymptote', text:'For f(x)=(xÂ²+1)/(xâˆ’1), perform polynomial division: f(x)=x+1+2/(xâˆ’1), so the slant asymptote is y=x+1.'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'u4q1', q:'For (2xÂ²+1)/(xÂ²âˆ’3), the horizontal asymptote is', opts:['y=0','y=2','none'], a:1, exp:'Degrees equal, ratio of leading coefficients = 2/1=2.'},
        {id:'u4q2', q:'Which function has a slant asymptote?', opts:['(x+1)/(xÂ²+1)','(xÂ²+1)/(x+1)','(2x+1)/(3xâˆ’1)'], a:1, exp:'Degree of numerator (2) > degree of denominator (1).'}
      ]}
    ]}
  ]},

  /* === Unit 5: Conic Sections === */
  5:{id:'u5', title:'Conic Sections', sections:[
    {id:'circles', title:'Circles', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'The standard form of a circle is (xâˆ’h)Â²+(yâˆ’k)Â²=rÂ², with center (h,k) and radius r.'},
        {type:'ex', title:'Circle Equation', text:'xÂ²+yÂ²+4xâˆ’6yâˆ’3=0 can be rewritten as (xÂ²+4x+4)+(yÂ²âˆ’6y+9)=3+4+9 â‡’ (x+2)Â²+(yâˆ’3)Â²=16, so center (âˆ’2,3), radius 4.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Find centers and radii of circles from their equations.'}], practice:[
        {id:'u5p1', kind:'mc', prompt:'xÂ²+yÂ²=25 has radius', options:['3','4','5'], correct:2, sol:'Standard form: rÂ²=25 â‡’ r=5.'},
        {id:'u5p2', kind:'mc', prompt:'The center of (xâˆ’2)Â²+(y+3)Â²=9 is', options:['(2,âˆ’3)','(âˆ’2,3)','(2,3)'], correct:0, sol:'Center is (h,k)=(2,âˆ’3).'}
      ]}]
    },
    {id:'parabolas', title:'Parabolas', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'For a parabola: yâˆ’k=a(xâˆ’h)Â² (opens up/down) or xâˆ’h=a(yâˆ’k)Â² (opens left/right). Vertex at (h,k), focus distance p=1/(4a).'},
        {type:'ex', title:'Parabola Features', text:'For y=2(xâˆ’1)Â²+3, vertex at (1,3), a=2>0 so opens upward, p=1/(4Ã—2)=1/8, so focus at (1,3+1/8)=(1,25/8).'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'u5q2', q:'For y=xÂ², the focus is at', opts:['(0,1/4)','(0,1)','(1,0)'], a:0, exp:'Standard form: y=1Ã—(xâˆ’0)Â²+0, so a=1, p=1/4, focus at (0,0+1/4).'},
        {id:'u5q3', q:'The directrix of y=âˆ’(1/8)xÂ² is', opts:['y=2','y=âˆ’2','y=0'], a:0, sol:'a=âˆ’1/8, p=1/(4Ã—|âˆ’1/8|)=2, since opens downward, directrix at y=0+2=2.'}
      ]}
    ]},
    {id:'ellipses', title:'Ellipses', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Standard forms: (xâˆ’h)Â²/aÂ²+(yâˆ’k)Â²/bÂ²=1 (horizontal major axis) or (xâˆ’h)Â²/bÂ²+(yâˆ’k)Â²/aÂ²=1 (vertical major axis), with aâ‰¥b. Foci at distance c from center, where cÂ²=aÂ²âˆ’bÂ².'},
        {type:'ex', title:'Ellipse Features', text:'For xÂ²/25+yÂ²/9=1, aÂ²=25 (a=5), bÂ²=9 (b=3), cÂ²=25âˆ’9=16 (c=4). Foci at (Â±4,0).'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'u5q3', q:'If a=5, b=4 in an ellipse, then c=', opts:['3','âˆš9','âˆš(25âˆ’16)'], a:2, exp:'c=âˆš(aÂ²âˆ’bÂ²)=âˆš(25âˆ’16)=âˆš9=3.'},
        {id:'u5q4', q:'For xÂ²/4+yÂ²/9=1, the major axis is', opts:['horizontal','vertical'], a:1, exp:'Larger denominator under yÂ², so vertical major axis.'}
      ]}
    ]},
    {id:'hyperbolas', title:'Hyperbolas', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Standard forms: (xâˆ’h)Â²/aÂ² âˆ’ (yâˆ’k)Â²/bÂ² = 1 (opens left/right) or (yâˆ’k)Â²/aÂ² âˆ’ (xâˆ’h)Â²/bÂ² = 1 (opens up/down). Asymptotes: yâˆ’k=Â±(b/a)(xâˆ’h) for horizontal hyperbola.'},
        {type:'ex', title:'Hyperbola Features', text:'For xÂ²/9âˆ’yÂ²/4=1, a=3, b=2, c=âˆš(9+4)=âˆš13. Asymptotes: y=Â±(2/3)x.'}
      ]}
    ]}
  ]},

  /* === Unit 6: Vectors === */
  6:{id:'u6', title:'Vectors', sections:[
    {id:'basics', title:'Basics & Operations', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Vectors have magnitude and direction. Magnitude |v|=âˆš(vâ‚Â²+vâ‚‚Â²). Unit vector u=v/|v| (when vâ‰ 0). Operations: addition (tip-to-tail), scalar multiplication.'},
        {type:'ex', title:'Vector Operations', text:'For v=âŸ¨3,4âŸ©, |v|=5, unit vector u=âŸ¨3/5,4/5âŸ©. For w=âŸ¨1,âˆ’2âŸ©, v+w=âŸ¨4,2âŸ©, 2v=âŸ¨6,8âŸ©.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Perform vector operations and compute magnitudes.'}], practice:[
        {id:'u6p1', kind:'numeric', prompt:'âŸ¨1,2âŸ©Â·âŸ¨3,4âŸ©=', ans:11, tol:1e-3, sol:'Dot product: 1Ã—3+2Ã—4=3+8=11.'},
        {id:'u6p2', kind:'mc', prompt:'|âŸ¨âˆ’3,4âŸ©|=', options:['5','7','25'], correct:0, sol:'âˆš((-3)Â²+4Â²)=âˆš(9+16)=âˆš25=5.'}
      ]}
    ]},
    {id:'dot', title:'Dot Product & Angle', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'The dot product: uÂ·v = uâ‚vâ‚+uâ‚‚vâ‚‚ = |u||v|cosÎ¸, where Î¸ is the angle between vectors. So Î¸ = arccos((uÂ·v)/(|u||v|)).'},
        {type:'ex', title:'Finding Angle', text:'For u=âŸ¨1,0âŸ© and v=âŸ¨1,âˆš3âŸ©, uÂ·v=1Ã—1+0Ã—âˆš3=1, |u|=1, |v|=2, so cosÎ¸=1/2, Î¸=60Â°.'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'u6q1', q:'If uÂ·v=0 and u,vâ‰ 0 then', opts:['parallel','orthogonal','equal'], a:1, exp:'Dot product zero â‡’ cosÎ¸=0 â‡’ Î¸=90Â° (orthogonal).'},
        {id:'u6q2', q:'The angle between âŸ¨1,1âŸ© and âŸ¨1,0âŸ© is', opts:['30Â°','45Â°','60Â°'], a:1, exp:'cosÎ¸=(1Ã—1+1Ã—0)/(âˆš2Ã—1)=1/âˆš2, so Î¸=45Â°.'}
      ]}
    ]}
  ]},

  /* === Unit 7: Matrices === */
  7:{id:'u7', title:'Matrices', sections:[
    {id:'arith', title:'Arithmetic & Properties', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Matrix addition/subtraction: element-wise, requires same dimensions. Matrix multiplication: AB defined when columns of A = rows of B. (AB)â‚–â‚— = Î£ Aâ‚–áµ¢Báµ¢â‚—.'},
        {type:'warn', text:'Matrix multiplication is not commutative: AB â‰  BA in general.'}
      ]}]
    },
    {id:'det', title:'Determinants & Inverses (2Ã—2)', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'For a 2Ã—2 matrix [a b; c d], the determinant is det = adâˆ’bc. If detâ‰ 0, the inverse is (1/det)Ã—[d âˆ’b; âˆ’c a].'},
        {type:'ex', title:'Matrix Inverse', text:'For A=[2 1; 1 1], det=2Ã—1âˆ’1Ã—1=1, so Aâ»Â¹=(1/1)[1 âˆ’1; âˆ’1 2]=[1 âˆ’1; âˆ’1 2].'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'u7q1', q:'The inverse exists iff', opts:['a+dâ‰ 0','adâˆ’bcâ‰ 0','abâˆ’cdâ‰ 0'], a:1, exp:'Nonzero determinant.'},
        {id:'u7q2', q:'det([3 1; 2 4])=', opts:['10','14','12'], a:0, exp:'3Ã—4âˆ’1Ã—2=12âˆ’2=10.'}
      ]}
    ]},
    {id:'systems', title:'Solving Linear Systems', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Systems can be solved using augmented matrices and row operations (Gaussian elimination), or using matrix inverses: Ax=b â‡’ x=Aâ»Â¹b (if A is invertible).'},
        {type:'ex', title:'Matrix Solution', text:'For system {2x+y=3, x+y=2}, write as [2 1; 1 1][x;y]=[3;2]. Then [x;y]=[1 âˆ’1; âˆ’1 2][3;2]=[1Ã—3+(âˆ’1)Ã—2; âˆ’1Ã—3+2Ã—2]=[1;1].'}
      ]}]
    }
  ]},

  /* === Unit 8: Probability & Combinatorics === */
  8:{id:'u8', title:'Probability & Combinatorics', sections:[
    {id:'counting', title:'Counting', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Permutations nPr = n!/(nâˆ’r)! (order matters). Combinations nCr = n!/(r!(nâˆ’r)!) (order doesn\'t matter). Multiplication principle: if there are m ways to do A and n ways to do B, then mÃ—n ways to do both.'},
        {type:'ex', title:'Counting Examples', text:'Number of ways to arrange 3 books: 3! = 6. Number of ways to choose 2 books from 5: 5C2 = 10.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Solve counting problems using permutations and combinations.'}], practice:[
        {id:'u8p1', kind:'numeric', prompt:'5C2 =', ans:10, tol:1e-3, sol:'5!/(2!3!)=120/(2Ã—6)=10.'},
        {id:'u8p2', kind:'mc', prompt:'Number of ways to arrange 4 people in a line', options:['16','24','64'], correct:1, sol:'4! = 24.'}
      ]}
    ]},
    {id:'binom', title:'Binomial & Expected Value', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Binomial Theorem: (a+b)^n = Î£ (n choose k) a^{nâˆ’k} b^k. For a Bernoulli trial with success probability p, E[X]=np for n trials.'},
        {type:'ex', title:'Expected Value', text:'If you flip a fair coin 100 times, expected number of heads = np = 100Ã—0.5=50.'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'u8q1', q:'Coefficient of xÂ² in (1+x)Â³', opts:['1','3','6'], a:1, exp:'(3 choose 2)=3.'},
        {id:'u8q2', q:'Expected value of rolling a die', opts:['3','3.5','4'], a:1, exp:'(1+2+3+4+5+6)/6=3.5.'}
      ]}
    ]}
  ]},

  /* === Unit 9: Series === */
  9:{id:'u9', title:'Series', sections:[
    {id:'seq', title:'Sequences', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Arithmetic sequence: a_n=a_1+(nâˆ’1)d. Geometric sequence: a_n=a_1 r^{nâˆ’1}. Explicit formula gives a_n directly; recursive formula defines terms relative to previous ones.'},
        {type:'ex', title:'Sequence Examples', text:'Arithmetic: 2,5,8,11,... (d=3). Geometric: 3,6,12,24,... (r=2).'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Find terms of sequences using explicit formulas.'}], practice:[
        {id:'u9p1', kind:'numeric', prompt:'Arithmetic a1=3, d=2 â‡’ a4 =', ans:9, tol:1e-3, sol:'a4=3+3Ã—2=9.'},
        {id:'u9p2', kind:'mc', prompt:'Geometric a1=5, r=3 â‡’ a3=', options:['15','30','45'], correct:2, sol:'a3=5Ã—3Â²=5Ã—9=45.'}
      ]}
    ]},
    {id:'series', title:'Series & Sigma', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Finite arithmetic series: S_n=n/2Ã—(a_1+a_n). Finite geometric series: S_n=a_1(1âˆ’r^n)/(1âˆ’r) for râ‰ 1. Infinite geometric series: S=a_1/(1âˆ’r) for |r|<1.'},
        {type:'ex', title:'Series Sums', text:'1+2+3+...+100=100/2Ã—(1+100)=5050. 1+1/2+1/4+1/8+...=1/(1âˆ’1/2)=2.'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'u9q1', q:'Sum of 1+2+3+...+n equals', opts:['nÂ²','n(n+1)/2','(nâˆ’1)n/2'], a:1, exp:'Classical formula.'},
        {id:'u9q2', q:'Sum of infinite geometric series 4+2+1+1/2+...', opts:['8','6','4'], a:0, exp:'a=4, r=1/2, S=4/(1âˆ’1/2)=8.'}
      ]}
    ]},
    {id:'binom', title:'Binomial Theorem', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'Binomial Theorem: (a+b)^n = Î£_{k=0}^n (n choose k) a^{nâˆ’k} b^k. The coefficients correspond to Pascal\'s Triangle.'},
        {type:'ex', title:'Binomial Expansion', text:'(x+y)Â³=xÂ³+3xÂ²y+3xyÂ²+yÂ³. The coefficients 1,3,3,1 are row 3 of Pascal\'s Triangle.'}
      ]}]
    }
  ]},

  /* === Unit 10: Limits & Continuity === */
  10:{id:'u10', title:'Limits & Continuity', sections:[
    {id:'limits', title:'Evaluating Limits', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'lim_{xâ†’a} f(x)=L means f(x) approaches L as x approaches a. Algebraic techniques: direct substitution, factoring/rationalizing, squeeze theorem.'},
        {type:'ex', title:'Limit Evaluation', text:'lim_{xâ†’2} (xÂ²âˆ’4)/(xâˆ’2) = lim_{xâ†’2} (x+2)(x-2)/(x-2) = lim_{xâ†’2} (x+2)=4.'}
      ]},
      {id:'quiz', label:'Quiz', tag:'Quiz', quiz:[
        {id:'u10q1', q:'lim_{xâ†’0} (sin x)/x =', opts:['0','1','undefined'], a:1, exp:'Classic limit = 1.'},
        {id:'u10q2', q:'lim_{xâ†’3} (xÂ²âˆ’9)/(xâˆ’3)=', opts:['3','6','0'], a:1, exp:'Simplify: (x-3)(x+3)/(x-3)=x+3, then substitute x=3: 6.'}
      ]}
    ]},
    {id:'cont', title:'Continuity & Discontinuities', pages:[
      {id:'theory', label:'Theory', tag:'Article', blocks:[
        {type:'p', text:'f is continuous at a if: 1) f(a) exists, 2) lim_{xâ†’a} f(x) exists, 3) lim_{xâ†’a} f(x)=f(a). Types of discontinuity: removable (hole), jump, infinite.'},
        {type:'ex', title:'Continuity Check', text:'f(x)=sin(x)/x has a removable discontinuity at x=0 (limit exists but f(0) undefined). f(x)=1/x has an infinite discontinuity at x=0.'}
      ]},
      {id:'practice', label:'Practice', tag:'Practice', blocks:[{type:'p', text:'Determine continuity and classify discontinuities.'}], practice:[
        {id:'u10p1', kind:'mc', prompt:'A hole is a', options:['jump','removable','infinite'], correct:1, sol:'Removable when a factor cancels.'},
        {id:'u10p2', kind:'mc', prompt:'f(x)=|x|/x at x=0 has a', options:['jump','removable','infinite'], correct:0, sol:'Left limit = âˆ’1, right limit = 1, so jump discontinuity.'}
      ]}
    ]}
  ]}
};

/* =================== RENDER ENGINE =================== */
let state = {unitId:null, sIdx:0, pIdx:0};

function $(sel){return document.querySelector(sel)}
function el(tag, cls){const n=document.createElement(tag); if(cls) n.className=cls; return n}
function clear(node){node.innerHTML=''}

// Expose globally so inline onclick="openUnit(n)" works
window.openUnit = function(n){
  const unit = UNITS[n];
  if(!unit){ alert('Unit not found.'); return; }
  state.unitId = n; state.sIdx = 0; state.pIdx = 0;
  $('#overviewPage').classList.add('hidden');
  $('#unitPage').classList.add('active');
  $('#unitSub').textContent = `Unit ${n} â€¢ ${unit.title}`;
  $('#sideTitle').textContent = `Unit ${n} Lessons`;
  renderSidebar();
  renderPage();
  window.scrollTo(0,0);
};

window.backToOverview = function(){
  $('#unitPage').classList.remove('active');
  $('#overviewPage').classList.remove('hidden');
  window.scrollTo(0,0);
};

function keyPrefix(){ return 'memolearn_'+UNITS[state.unitId].id+'_'; }
function save(k,v){ try{ localStorage.setItem(keyPrefix()+k, JSON.stringify(v)); }catch(e){} }
function load(k,d){ try{ const v=localStorage.getItem(keyPrefix()+k); return v?JSON.parse(v):d; }catch(e){ return d; } }

function renderSidebar(){
  const unit = UNITS[state.unitId];
  const ul = $('#lessonList'); clear(ul);
  unit.sections.forEach((sec, si)=>{
    sec.pages.forEach((pg, pi)=>{
      const li = el('li');
      const a = el('a','lesson'); a.href='#'; a.dataset.s=si; a.dataset.p=pi;
      
      // Set active class if this is the current page
      if(state.sIdx === si && state.pIdx === pi) {
        a.classList.add('active');
      }
      
      const tag = el('span','tag'); tag.textContent = pg.tag||'Item';
      const title = el('span'); title.textContent = `${sec.title} â€” ${pg.label}`;
      const done = el('span','done'); done.innerHTML = '<i class="fas fa-check"></i> Completed';
      
      if(load('done_'+sec.id+'_'+pg.id,false)) {
        li.classList.add('completed');
      }
      
      a.appendChild(tag); 
      a.appendChild(title); 
      a.appendChild(done); 
      li.appendChild(a); 
      ul.appendChild(li);
    });
  });
  
  // Use property assignment to avoid stacking multiple listeners
  ul.onclick = (e)=>{
    const a = e.target.closest('a.lesson'); 
    if(!a) return; 
    e.preventDefault();
    state.sIdx = Number(a.dataset.s); 
    state.pIdx = Number(a.dataset.p); 
    renderPage();
  };
}

function renderPage(){
  const unit = UNITS[state.unitId];
  const sec = unit.sections[state.sIdx];
  const pg  = sec.pages[state.pIdx];
  
  $('#crumbs').innerHTML = `
    <span>Unit ${state.unitId}</span>
    <span>${sec.title}</span>
    <span>${pg.label}</span>
  `;
  
  $('#title').textContent  = sec.title;
  $('#lead').textContent   = (pg.lead || (pg.tag==='Quiz'?'Test your understanding':'Learn and practice'));

  const content = $('#content'); clear(content);
  (pg.blocks||[]).forEach(b=>{
    if(b.type==='p'){
      const p=el('p'); 
      p.innerHTML = b.text; 
      content.appendChild(p); 
    }
    if(b.type==='ex'){
      const d=el('div','example'); 
      const h=el('h4'); 
      h.innerHTML = `<i class="fas fa-lightbulb"></i> ${b.title||'Example'}`; 
      d.appendChild(h); 
      const p=el('p'); 
      p.innerHTML = b.text; 
      d.appendChild(p); 
      content.appendChild(d); 
    }
    if(b.type==='note'){
      const n=el('div','note'); 
      n.innerHTML = b.text; 
      content.appendChild(n); 
    }
    if(b.type==='warn'){
      const w=el('div','warn'); 
      w.innerHTML = b.text; 
      content.appendChild(w); 
    }
    if(b.type==='definition'){
      const def=el('div','definition');
      const h=el('h4');
      h.innerHTML = `<i class="fas fa-book"></i> ${b.title||'Definition'}`;
      def.appendChild(h);
      const p=el('p');
      p.innerHTML = b.text;
      def.appendChild(p);
      content.appendChild(def);
    }
    if(b.type==='highlight'){
      const highlight=el('div','highlight');
      const h=el('h4');
      h.innerHTML = `<i class="fas fa-star"></i> ${b.title||'Key Insight'}`;
      highlight.appendChild(h);
      const p=el('p');
      p.innerHTML = b.text;
      highlight.appendChild(p);
      content.appendChild(highlight);
    }
    if(b.type==='key-takeaways'){
      const kt=el('div','key-takeaways');
      const h=el('h4');
      h.innerHTML = `<i class="fas fa-check-circle"></i> ${b.title||'Key Takeaways'}`;
      kt.appendChild(h);
      
      if (typeof b.text === 'string') {
        const p=el('p');
        p.innerHTML = b.text;
        kt.appendChild(p);
      } else if (Array.isArray(b.text)) {
        const ul = el('ul');
        b.text.forEach(item => {
          const li = el('li');
          li.textContent = item;
          ul.appendChild(li);
        });
        kt.appendChild(ul);
      }
      
      content.appendChild(kt);
    }
  });

  renderPractice(pg); 
  renderQuiz(pg); 
  updateNavButtons(); 
  updateProgress();
  
  // Update active lesson in sidebar
  document.querySelectorAll('.lesson').forEach(lesson => {
    lesson.classList.remove('active');
  });
  
  const activeLesson = document.querySelector(`.lesson[data-s="${state.sIdx}"][data-p="${state.pIdx}"]`);
  if (activeLesson) {
    activeLesson.classList.add('active');
  }
}

function renderPractice(pg){
  const box = $('#practice'); clear(box);
  if(!pg.practice || !pg.practice.length) return;
  
  const h = el('h3'); 
  h.innerHTML = '<i class="fas fa-pencil-alt"></i> Practice Problems'; 
  box.appendChild(h);
  
  const desc = el('p');
  desc.textContent = 'Try solving these practice problems. Check your answers and review the solutions to deepen your understanding.';
  desc.style.marginBottom = '16px';
  desc.style.color = 'var(--muted)';
  box.appendChild(desc);
  
  pg.practice.forEach(p=>{
    const wrap = el('div','problem');
    const title = el('h5'); 
    title.innerHTML = `<i class="fas fa-question-circle"></i> ${p.prompt}`; 
    wrap.appendChild(title);
    
    const result = el('div');
    
    if(p.kind==='numeric'){
      const inputGroup = el('div');
      inputGroup.style.display = 'flex';
      inputGroup.style.gap = '8px';
      inputGroup.style.alignItems = 'center';
      inputGroup.style.flexWrap = 'wrap';
      
      const input = el('input','input'); 
      input.inputMode='decimal'; 
      input.placeholder='Enter a number';
      input.addEventListener('keypress', function(e) {
        if(e.key === 'Enter') {
          checkAnswer();
        }
      });
      
      const btn = el('button','btn'); 
      btn.innerHTML = '<i class="fas fa-check"></i> Check'; 
      
      inputGroup.appendChild(input); 
      inputGroup.appendChild(btn); 
      wrap.appendChild(inputGroup); 
      wrap.appendChild(result);
      
      const checkAnswer = () => {
        const val = parseFloat(String(input.value).replace(/[^0-9+\-\.eE]/g,''));
        if(isNaN(val)){ 
          result.className='bad'; 
          result.innerHTML = '<i class="fas fa-times-circle"></i> Please enter a valid number.'; 
          return; 
        }
        const ok = Math.abs(val - p.ans) <= (p.tol||1e-6);
        result.className = ok?'ok':'bad';
        result.innerHTML = ok 
          ? '<i class="fas fa-check-circle"></i> Correct! Well done.' 
          : '<i class="fas fa-times-circle"></i> Not quite. Try again.';
        
        if (ok) {
          wrap.classList.add('correct-pulse');
          setTimeout(() => wrap.classList.remove('correct-pulse'), 500);
        }
      };
      
      btn.onclick = checkAnswer;
    } else if(p.kind==='mc'){
      const opts = el('div');
      (p.options||[]).forEach((opt,i)=>{
        const lab = el('label','choice');
        const r = el('input'); 
        r.type='radio'; 
        r.name=p.id; 
        r.value=String(i);
        
        r.addEventListener('change', function() {
          // Visual feedback when an option is selected
          document.querySelectorAll(`input[name="${p.id}"]`).forEach(inp => {
            inp.parentElement.style.background = '';
            inp.parentElement.style.borderColor = '';
          });
          if (this.checked) {
            this.parentElement.style.background = '#f0f4ff';
            this.parentElement.style.borderColor = 'var(--indigo)';
          }
        });
        
        const s = el('span'); 
        s.textContent=opt; 
        lab.appendChild(r); 
        lab.appendChild(s); 
        opts.appendChild(lab);
      });
      
      const btn = el('button','btn'); 
      btn.innerHTML = '<i class="fas fa-check"></i> Check'; 
      btn.style.marginTop='12px';
      
      wrap.appendChild(opts); 
      wrap.appendChild(btn); 
      wrap.appendChild(result);
      
      btn.onclick = ()=>{
        const chosen = Array.from(opts.querySelectorAll('input')).find(i=>i.checked);
        if(!chosen){ 
          result.className='bad'; 
          result.innerHTML = '<i class="fas fa-times-circle"></i> Please select an option.'; 
          return; 
        }
        const ok = Number(chosen.value)===p.correct; 
        result.className=ok?'ok':'bad';
        result.innerHTML = ok 
          ? '<i class="fas fa-check-circle"></i> Correct!' 
          : '<i class="fas fa-times-circle"></i> Incorrect. Try again.';
        
        if (ok) {
          wrap.classList.add('correct-pulse');
          setTimeout(() => wrap.classList.remove('correct-pulse'), 500);
        }
      };
    }
    
    const help = el('span','help'); 
    help.innerHTML = '<i class="fas fa-lightbulb"></i> Show solution';
    const sol = el('div','solution'); 
    sol.innerHTML = p.sol||'Solution coming soon.';
    
    help.onclick=()=>{ 
      sol.style.display = sol.style.display==='block'?'none':'block'; 
      help.innerHTML = sol.style.display==='block' 
        ? '<i class="fas fa-eye-slash"></i> Hide solution' 
        : '<i class="fas fa-lightbulb"></i> Show solution';
    };
    
    wrap.appendChild(help); 
    wrap.appendChild(sol); 
    box.appendChild(wrap);
  });
}

function renderQuiz(pg){
  const box = $('#quiz'); clear(box);
  if(!pg.quiz || !pg.quiz.length) return;
  
  const h = el('h3'); 
  h.innerHTML = '<i class="fas fa-tasks"></i> Quiz'; 
  box.appendChild(h);
  
  const desc = el('p');
  desc.textContent = 'Test your knowledge with this quick quiz. Submit your answers to see your score and review explanations.';
  desc.style.marginBottom = '16px';
  desc.style.color = 'var(--muted)';
  box.appendChild(desc);
  
  const qs = el('div'); 
  box.appendChild(qs);
  
  (pg.quiz||[]).forEach((q,idx)=>{
    const qEl = el('div','q');
    const title = el('h5'); 
    title.innerHTML = `<i class="fas fa-question"></i> ${idx+1}. ${q.q}`; 
    qEl.appendChild(title);
    
    (q.opts||[]).forEach((opt,i)=>{
      const lab = el('label','choice'); 
      const r=el('input'); 
      r.type='radio'; 
      r.name=q.id; 
      r.value=String(i);
      
      const s = el('span'); 
      s.textContent=opt; 
      lab.appendChild(r); 
      lab.appendChild(s); 
      qEl.appendChild(lab);
    });
    qs.appendChild(qEl);
  });
  
  const toolbar = el('div'); 
  toolbar.style.display='flex'; 
  toolbar.style.gap='12px'; 
  toolbar.style.marginTop='20px';
  toolbar.style.alignItems = 'center';
  
  const submit = el('button','btn'); 
  submit.innerHTML = '<i class="fas fa-paper-plane"></i> Submit'; 
  
  const reset = el('button','btn secondary'); 
  reset.innerHTML = '<i class="fas fa-redo"></i> Reset'; 
  reset.style.display='none';
  
  const score = el('div', 'score-display'); 
  toolbar.appendChild(submit); 
  toolbar.appendChild(reset); 
  toolbar.appendChild(score); 
  box.appendChild(toolbar);

  submit.onclick=()=>{
    let correct=0; 
    const total=(pg.quiz||[]).length;
    
    (pg.quiz||[]).forEach((q,i)=>{
      const chosen = document.querySelector(`input[name="${q.id}"]:checked`);
      const block = qs.children[i];
      
      // Remove any previous result
      const prevResult = block.querySelector('.quiz-result');
      if (prevResult) prevResult.remove();
      
      const res = el('div', 'quiz-result');
      res.style.marginTop = '10px';
      
      if(chosen && Number(chosen.value)===q.a){
        res.className='ok'; 
        res.innerHTML = `<i class="fas fa-check-circle"></i> Correct â€” ${q.exp}`;
        correct++; 
        
        // Visual feedback
        chosen.parentElement.style.background = '#d1fae5';
        chosen.parentElement.style.borderColor = 'var(--success)';
      } else { 
        res.className='bad'; 
        res.innerHTML = `<i class="fas fa-times-circle"></i> Incorrect â€” Correct answer: ${q.opts[q.a]}. ${q.exp}`;
        
        // Highlight correct answer
        const correctOption = block.querySelector(`input[name="${q.id}"][value="${q.a}"]`);
        if (correctOption) {
          correctOption.parentElement.style.background = '#fee2e2';
          correctOption.parentElement.style.borderColor = 'var(--danger)';
        }
        
        // Highlight incorrect selection if any
        if (chosen) {
          chosen.parentElement.style.background = '#fef3c7';
          chosen.parentElement.style.borderColor = 'var(--warning)';
        }
      }
      block.appendChild(res);
    });
    
    const percentage = Math.round(100*correct/Math.max(1,total));
    score.textContent = `Score: ${correct}/${total} (${percentage}%)`;
    
    // Color code based on performance
    if (percentage >= 80) {
      score.style.color = 'var(--success)';
    } else if (percentage >= 60) {
      score.style.color = 'var(--warning)';
    } else {
      score.style.color = 'var(--danger)';
    }
    
    reset.style.display='inline-block'; 
    submit.disabled=true;
    
    // Mark as completed if score is good (optional)
    if (correct >= total * 0.7) {
      const unit = UNITS[state.unitId]; 
      const sec=unit.sections[state.sIdx]; 
      const pgc=sec.pages[state.pIdx];
      save('done_'+sec.id+'_'+pgc.id,true); 
      renderSidebar();
    }
  };
  
  reset.onclick=()=>{ 
    renderPage(); 
  };
}

function updateNavButtons(){
  const unit = UNITS[state.unitId];
  const isFirst = state.sIdx===0 && state.pIdx===0;
  const isLast  = state.sIdx===unit.sections.length-1 && state.pIdx===unit.sections[state.sIdx].pages.length-1;
  
  $('#prevBtn').disabled = isFirst; 
  $('#nextBtn').disabled = isLast;
  
  $('#prevBtn').onclick = goPrev; 
  $('#nextBtn').onclick = goNext;
  
  // Update next button text
  $('#nextBtn').innerHTML = isLast 
    ? 'Finish <i class="fas fa-flag-checkered"></i>' 
    : 'Next <i class="fas fa-arrow-right"></i>';
}

function goPrev(){ 
  const unit=UNITS[state.unitId]; 
  if(state.pIdx>0) {
    state.pIdx--; 
  } else if(state.sIdx>0){ 
    state.sIdx--; 
    state.pIdx=unit.sections[state.sIdx].pages.length-1; 
  } 
  renderPage(); 
  window.scrollTo(0,0);
}

function goNext(){ 
  const unit=UNITS[state.unitId]; 
  if(state.pIdx<unit.sections[state.sIdx].pages.length-1) {
    state.pIdx++; 
  } else if(state.sIdx<unit.sections.length-1){ 
    state.sIdx++; 
    state.pIdx=0; 
  } 
  renderPage(); 
  window.scrollTo(0,0);
}

function updateProgress(){
  const unit = UNITS[state.unitId]; 
  let total=0, done=0;
  
  unit.sections.forEach(sec=>{
    sec.pages.forEach(pg=>{ 
      total++; 
      if(load('done_'+sec.id+'_'+pg.id,false)) done++; 
    });
  });
  
  const pct = Math.round(100*done/Math.max(1,total));
  $('#progressbar').style.width=pct+'%';
  $('#progressText').textContent = `${pct}% Complete`;
}

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
  // Add any initialization code if needed
});

// ---------- Minimal self-tests (sanity checks without changing behavior) ----------
console.assert(typeof window.openUnit === 'function', 'openUnit should be defined globally');
console.assert(typeof window.backToOverview === 'function', 'backToOverview should be defined globally');
console.assert(document.getElementById('overviewPage'), 'overviewPage element should exist');
console.assert(Object.keys(UNITS).length === 10, 'There should be 10 units defined');
console.assert((UNITS[1]||{}).sections && UNITS[1].sections.length>0, 'Unit 1 should have sections');
</script>
</body>
</html>
